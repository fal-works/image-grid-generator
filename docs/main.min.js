/**
 * Image Grid Generator.
 * @copyright FAL
 * @version 0.1.0
 */
!function(t){"use strict";let e;t=t&&t.hasOwnProperty("default")?t.default:t;const o=t=>t.size(),i="absolute",n=(t,e,o=i)=>{const n=t.elt.style,{x:r,y:h}=e;return n.position=o,n.left=`${r}px`,n.top=`${h}px`,t},r=(t,e,i)=>{((t,e)=>{const{width:i,height:n}=o(t),r=Math.min(e.width/i,e.height/n);t.size(i*r,n*r)})(t,i);const r=o(t);n(t,{x:e.x+(i.width-r.width)/2,y:e.y+(i.height-r.height)/2})},h=t=>{const{label:o,onClick:i,position:r,size:h,cursor:l}=t,s=e.createButton(o);return s.mouseClicked(i),n(s,r),s.size(h.width,h.height),l&&s.style("cursor",l),s},l=t=>{const{file:{data:o},alt:i,hide:n}=t,r=e.createImg(o,i,()=>{const{file:e,warnOnFail:o,onLoad:i,onFail:n}=t;if(!r)return o&&console.warn(`"Failed to load ${e.name}`),void(n&&n(e));i&&i(r,e)});return n&&r.hide(),r},s=()=>{},a=()=>void 0,c=1280,d=800,g=0,u={width:c-d,height:d},p={x:g,y:0},m={width:u.width-20,height:420},w={x:p.x+1,y:p.y+1},f={width:m.width-2,height:m.height-2},y={x:g,y:p.y+m.height+20},v={width:120,height:40},b={x:y.x+16+v.width,y:y.y},M={width:120,height:40},F={x:g,y:y.y+40+20},C={width:u.width-20,height:u.height-(m.height+20+40+20)},z={width:c-u.width,height:d},x={x:u.width,y:0},k={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",fileName:"image-grid.png"},E=(t=>JSON.stringify(t,void 0,2))(k),L=(t,e)=>""===t||isFinite(e)||"object"==typeof e&&!Array.isArray(e)||"string"==typeof e?e:void 0,I=(t,e,o=-1e4,i=1e4)=>{const n=parseInt(t);return Number.isFinite(n)&&n>=o&&n<=i?n:e},O=(t,e,o=100)=>{const i=t.toString();return"string"==typeof i&&i.length>0&&i.length<=o?i:e},D=t=>{return{width:I(t.width,k.width,1),height:I(t.height,k.height,1),columns:I(t.columns,k.columns,1),rows:I(t.rows,k.rows,1),outerMargin:(t=>{const e=k.outerMargin;if("number"==typeof t){const o=I(t,e.top);return{top:o,bottom:o,left:o,right:o}}return{top:I(t.top,e.top),bottom:I(t.bottom,e.bottom),left:I(t.left,e.left),right:I(t.right,e.right)}})(t.outerMargin),innerMargin:I(t.innerMargin,k.innerMargin),backgroundColorCode:O(t.backgroundColorCode,k.backgroundColorCode),fileName:O(t.fileName,k.fileName)}},N=t=>{const{width:e,height:o,columns:i,rows:n,outerMargin:r,innerMargin:h}=t,l=t.width-r.left-r.right,s=t.height-r.top-r.bottom;return{contentWidth:l,contentHeight:s,contentLeftX:r.left,contentTopY:r.top,contentRightX:e-r.right,contentBottomY:o-r.bottom,columnWidth:l/i,rowHeight:s/n,cellWidth:(l-(i-1)*h)/i,cellHeight:(s-(n-1)*h)/n}},W=()=>{},T={onChange:W,onMouseEnter:W,onMouseLeave:W},A=t=>{const{onChange:o,onMouseEnter:i,onMouseLeave:r}=Object.assign(Object.create(T),t),h=(t=>{const{position:o,size:i,initialValue:r}=t,h=e.createElement("textarea",r);return n(h,o).size(i.width,i.height),h})({position:F,size:C,initialValue:E}),l={element:h,contentText:E,parameters:k,monitorIntervalId:void 0},s=()=>{const t=h.value().toString();t!==l.contentText&&(l.contentText=t,l.parameters=(t=>{if("string"!=typeof t)return k;try{return D(JSON.parse(t,L))}catch(t){return k}})(t),o(l))};return h.elt.addEventListener("focus",()=>{l.monitorIntervalId=setInterval(s,100)}),h.elt.addEventListener("blur",()=>{const{monitorIntervalId:t}=l;t&&(clearInterval(t),l.monitorIntervalId=void 0)}),h.elt.addEventListener("mouseenter",i.bind(void 0,l)),h.elt.addEventListener("mouseleave",r.bind(void 0,l)),l},H=(t,e,o,i,n)=>{const h=Math.floor(e/i),l=e%i,s={x:o.x+n.width*l,y:o.y+n.height*h};r(t,s,n)},S=(t,e)=>{const{position:o,size:i,cellSize:n,columns:r,elements:h}=t;e.show(),H(e,h.length,o,r,n),t.elements.push(e),Math.ceil(h.length/r)*n.height>i.height&&((t,e)=>{const{position:o,size:i,elements:n}=t;t.columns=e;const r=i.width/e;t.cellSize={width:r,height:r};for(let i=0;i<n.length;i+=1)H(n[i],i,o,e,t.cellSize)})(t,r+1)},R=t=>{const{width:o,height:i,columns:n,rows:r,innerMargin:h}=t,{contentWidth:l,contentHeight:s,contentLeftX:a,contentTopY:c,contentRightX:d,contentBottomY:g,columnWidth:u,rowHeight:p,cellWidth:m,cellHeight:w}=N(t);if(e.push(),e.translate((e.width-o)/2,(e.height-i)/2),e.stroke(255,64,128),e.noFill(),e.rect(1,1,o-2,i-2),e.rect(a+1,c+1,l-2,s-2),0===h){for(let t=1,o=a;t<n;t+=1)o+=u,e.line(o,c,o,g);for(let t=1,o=c;t<r;t+=1)o+=p,e.line(a,o,d,o)}else{for(let t=1,o=a;t<n;t+=1)o+=m,e.line(o,c,o,g),o+=h,e.line(o,c,o,g);for(let t=1,o=c;t<r;t+=1)o+=w,e.line(a,o,d,o),o+=h,e.line(a,o,d,o)}e.pop()},B=[];let X,Y,j,$=void 0,G=!1,J=()=>{e.background(255),e.push(),e.stroke(224),e.noFill(),e.strokeWeight(1),e.rect(1,1,e.width-2,e.height-2),e.pop()};const P=()=>{G=!1,e.cursor(e.ARROW),Y.style("cursor","pointer"),j.style("cursor","pointer")},V=t=>o=>{if(o.length<=0)return void P();const i=((t,o)=>{const{width:i,height:n,rows:r,columns:h,outerMargin:l,innerMargin:s,backgroundColorCode:a}=o,c=t.length,{cellWidth:d,cellHeight:g}=N(o),u=e.createGraphics(i,n),p=e.color(a);e.alpha(p)>0&&u.background(p),u.push(),u.imageMode(e.CENTER),u.translate(l.left+d/2,l.top+g/2);let m=0;for(let e=0,o=0;e<r;e+=1,o+=g+s)for(let e=0,i=0;e<h&&!(m>=c);e+=1,i+=d+s){const e=t[m++],n=e.width,r=e.height,h=Math.min(d/n,g/r);u.image(e,i,o,h*n,h*r)}return u.pop(),u})(o,t),n=Math.min(1,Math.min(e.width/i.width,e.height/i.height)),r=n*i.width,h=n*i.height;J=()=>{e.background(255),e.image(i,e.width/2,e.height/2,r,h)},J(),$=i,P()},q=()=>{if(G)return;const{parameters:t}=X,o=t.rows*t.columns;if(o<1)return;const i=e.shuffle(B).slice(0,o);i.length<=0||(G=!0,e.cursor(e.WAIT),Y.style("cursor","wait"),j.style("cursor","wait"),(t=>{const{files:e,hide:o,warnOnFail:i}=t;if(e.length<=0)return;const n=t.getAlt||a,r=t.onLoadEach||s,h=t.onFailEach||s,c=t.onComplete||s;let d=t.onFailAny||s;const g=e.length,u=[];for(let t=0;t<e.length;t+=1){const a=e[t];l({file:a,alt:n(a),hide:o,onLoad:(e,o)=>{r(e,o,t),u.push(e),u.length===g&&c(u)},onFail:o=>{h(o,t),d(e),d=s},warnOnFail:i})}})({files:i,hide:!0,warnOnFail:!0,onComplete:V(t),onFailAny:P}))},K=()=>{$&&e.save($,X.parameters.fileName)},Q=()=>{const t=(t=>{const{position:e,size:o,initialColumns:i}=t,n=o.width/i;return{position:e,size:o,columns:i,cellSize:{width:n,height:n},elements:[]}})({position:w,size:f,initialColumns:4}),o=(t,e)=>{t.style("pointer-events","none"),B.push(e)};(t=>{const{position:o,size:i,onDrop:r}=t,h=e.createDiv("Drop image files here"),l=()=>{h.style("background-color","#FDFDFD"),h.style("cursor","auto")};n(h,o).size(i.width,i.height),h.addClass("drop-zone"),h.dragOver(()=>{h.style("background-color","#F0FAFF"),h.style("cursor","wait")}).dragLeave(l).drop(r,()=>{l(),h.elt.innerHTML=""}),l()})({position:p,size:m,onDrop:e=>((t,e,o)=>{"image"===e.type?l({file:e,alt:e.name,onLoad:(e,i)=>{S(t,e),o(e,i)}}).hide():console.warn("Dropped file that is not an image:",e)})(t,e,o)})},U=()=>{const{width:t,height:o}=z,i=e.createCanvas(t,o);n(i,x),window.addEventListener("dragover",t=>{t.preventDefault()},!1),window.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation()},!1),e.imageMode(e.CENTER),Q(),Y=h({label:"generate",onClick:q,position:y,size:v,cursor:"pointer"}),j=h({label:"save",onClick:K,position:b,size:M,cursor:"pointer"}),X=A({onMouseEnter:t=>{R(t.parameters)},onMouseLeave:()=>{J()},onChange:t=>{J(),R(t.parameters)}}),e.background(255),R(k)};new t(t=>{(t=>e=t)(t),e.setup=U},document.getElementById("ImageGridResult")||document.body)}(p5);