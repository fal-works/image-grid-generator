/**
 * Image Grid Generator.
 * @copyright 2019 FAL
 * @version 1.0.2
 */
!function(e,t){"use strict";let n;e=e&&e.hasOwnProperty("default")?e.default:e;var i;!function(e){e[e.IE=0]="IE",e[e.Edge=1]="Edge",e[e.Chrome=2]="Chrome",e[e.Safari=3]="Safari",e[e.FireFox=4]="FireFox",e[e.Opera=5]="Opera",e[e.Other=6]="Other"}(i||(i={}));const o=(e,t)=>{const n=((e,t)=>{const{width:n,height:i}=e;return Math.min(t.width/n,t.height/i)})(e,t);return{width:e.width*n,height:e.height*n}},r=(e,t)=>{const{width:n,height:i}=e;return Math.min(1,Math.min(t.width/n,t.height/i))},s=e=>e.size(),h="absolute",a=(e,t,n=h)=>{const i=e.elt.style,{x:o,y:r}=t;return i.position=n,i.left=`${o}px`,i.top=`${r}px`,e},l=(e,t,n)=>{((e,t)=>{const n=o(s(e),t);e.size(n.width,n.height)})(e,n);const i=s(e);a(e,{x:t.x+(n.width-i.width)/2,y:t.y+(n.height-i.height)/2})},c=e=>{const{label:t,onClick:i,position:o,size:r,cursor:s}=e,h=n.createButton(t);return h.mouseClicked(i),a(h,o),h.size(r.width,r.height),s&&h.style("cursor",s),h},d=e=>{const{file:{data:t},alt:i,hide:o}=e,r=n.createImg(t,i,()=>{const{file:t,warnOnFail:n,onLoad:i,onFail:o}=e;if(!r)return n&&console.warn(`"Failed to load ${t.name}`),void(o&&o(t));i&&i(r,t)});return o&&r.hide(),r},g=()=>{},u={getAlt:()=>void 0,hide:!1,onLoadEach:g,onFailEach:g,warnOnFail:!0,onSuccess:g,onFailAny:g,onEnd:g},p=1035,w=640,m=0,f={width:p-w,height:w},y={x:m,y:0},v={width:f.width-20,height:280},b={x:y.x+2,y:y.y+2},F={width:v.width-4,height:v.height-4},x={x:m,y:y.y+v.height+15},E={width:120,height:40},M={x:x.x+16+E.width,y:x.y},O={width:120,height:40},C={x:m,y:x.y+40+15},z={width:f.width-20,height:f.height-(v.height+15+40+15+5+30)},L={x:m,y:f.height-30},k=70,I=30,S={width:60,height:30},A={x:f.width-20-S.width,y:L.y},N={width:p-f.width,height:w},D={x:f.width,y:0},W={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",fileName:"image-grid.png"},T=e=>t.safeDump(e),$=T(W),H=(e,t)=>""===e||isFinite(t)||"object"==typeof t&&!Array.isArray(t)||"string"==typeof t?t:void 0,P=(e,t,n=-1e4,i=1e4)=>{const o=parseInt(e);return Number.isFinite(o)&&o>=n&&o<=i?o:t},R="[\\da-fA-F]",Y=new RegExp(`^(${R}{3}|${R}{4}|${R}{6}|${R}{8})$`),j=e=>{return{width:P(e.width,W.width,1),height:P(e.height,W.height,1),columns:P(e.columns,W.columns,1),rows:P(e.rows,W.rows,1),outerMargin:(e=>{const t=W.outerMargin;if("number"==typeof e){const n=P(e,t.top);return{top:n,bottom:n,left:n,right:n}}return{top:P(e.top,t.top),bottom:P(e.bottom,t.bottom),left:P(e.left,t.left),right:P(e.right,t.right)}})(e.outerMargin),innerMargin:P(e.innerMargin,W.innerMargin),backgroundColorCode:((e,t)=>{const n=e.toString();return"string"==typeof n?n.match(Y)?`#${n}`:n:t})(e.backgroundColorCode,W.backgroundColorCode),fileName:((e,t,n=100)=>{const i=e.toString();return"string"==typeof i&&i.length>0&&i.length<=n?i:t})(e.fileName,W.fileName,255)}},B=e=>{const{width:t,height:n,columns:i,rows:o,outerMargin:r,innerMargin:s}=e,h=e.width-r.left-r.right,a=e.height-r.top-r.bottom;return{contentWidth:h,contentHeight:a,contentLeftX:r.left,contentTopY:r.top,contentRightX:t-r.right,contentBottomY:n-r.bottom,columnWidth:h/i,rowHeight:a/o,cellWidth:(h-(i-1)*s)/i,cellHeight:(a-(o-1)*s)/o}},J=()=>{},X={onChange:J,onMouseEnter:J,onMouseLeave:J},G=e=>{const{onChange:i,onMouseEnter:o,onMouseLeave:r}=Object.assign(Object.create(X),e),s=(e=>{const{position:t,size:i,initialValue:o}=e,r=n.createElement("textarea",o);return a(r,t).size(i.width,i.height),r})({position:C,size:z,initialValue:$}),h={element:s,contentText:$,parameters:W,monitorIntervalId:void 0},l=()=>{const e=s.value().toString();e!==h.contentText&&(h.contentText=e,h.parameters=(e=>{if("string"!=typeof e)return W;const n=e.trim();try{return"{"===n.substr(0,1)?j(JSON.parse(n,H)):j(t.safeLoad(n))}catch(e){return W}})(e),i(h))},d=e=>{h.element.value(e),l()},g=e=>d((e=>JSON.stringify(e,void 0,2))(e)),u=s.elt;u.addEventListener("focus",()=>{h.monitorIntervalId=setInterval(l,100)}),u.addEventListener("blur",()=>{const{monitorIntervalId:e}=h;e&&(clearInterval(e),h.monitorIntervalId=void 0)}),u.addEventListener("mouseenter",o.bind(void 0,h)),u.addEventListener("mouseleave",r.bind(void 0,h));const p=n.createSelect();return p.position(L.x,L.y),p.size(k,I),p.option("YAML"),p.option("JSON"),p.changed(()=>{switch(p.value().toString()){case"YAML":(e=>d(T(e)))(h.parameters);break;case"JSON":g(h.parameters)}}),c({label:"reset",onClick:()=>{d($),p.value("YAML")},position:A,size:S,cursor:"pointer"}).style("font-size","medium"),h},V=(e,t,n,i,o)=>{const r=Math.floor(t/i),s=t%i,h={x:n.x+o.width*s,y:n.y+o.height*r};l(e,h,o)},q=(e,t)=>{const{position:n,size:i,cellSize:o,columns:r,elements:s}=e;t.show(),V(t,s.length,n,r,o),e.elements.push(t),Math.ceil(s.length/r)*o.height>i.height&&((e,t)=>{const{position:n,size:i,elements:o}=e;e.columns=t;const r=i.width/t;e.cellSize={width:r,height:r};for(let i=0;i<o.length;i+=1)V(o[i],i,n,t,e.cellSize)})(e,r+1)},K=e=>{const{width:t,height:i,columns:o,rows:s,innerMargin:h}=e,{contentWidth:a,contentHeight:l,contentLeftX:c,contentTopY:d,contentRightX:g,contentBottomY:u,columnWidth:p,rowHeight:w,cellWidth:m,cellHeight:f}=B(e);n.push(),n.translate(n.width/2,n.height/2);const y=r(e,n);if(n.scale(y),n.strokeWeight(1/y),n.translate(-t/2,-i/2),n.stroke(255,64,128),n.noFill(),n.rect(1,1,t-2,i-2),n.rect(c+1,d+1,a-2,l-2),0===h){for(let e=1,t=c;e<o;e+=1)t+=p,n.line(t,d,t,u);for(let e=1,t=d;e<s;e+=1)t+=w,n.line(c,t,g,t)}else{for(let e=1,t=c;e<o;e+=1)t+=m,n.line(t,d,t,u),t+=h,n.line(t,d,t,u);for(let e=1,t=d;e<s;e+=1)t+=f,n.line(c,t,g,t),t+=h,n.line(c,t,g,t)}n.pop()},Q=[];let U,Z,_,ee=void 0,te=!1,ne=()=>{n.background(255),n.push(),n.stroke(224),n.noFill(),n.strokeWeight(1),n.rect(1,1,n.width-2,n.height-2),n.pop()};const ie=()=>{te=!1,n.cursor(n.ARROW),Z.style("cursor","pointer"),_.style("cursor","pointer")},oe=e=>t=>{if(t.length<=0)return;const i=((e,t)=>{const{width:i,height:r,rows:s,columns:h,outerMargin:a,innerMargin:l,backgroundColorCode:c}=t,d=e.length,{cellWidth:g,cellHeight:u}=B(t),p=n.createGraphics(i,r),w=n.color(c);n.alpha(w)>0&&p.background(w),p.push(),p.imageMode(n.CENTER),p.translate(a.left+g/2,a.top+u/2);let m=0;for(let t=0,n=0;t<s;t+=1,n+=u+l)for(let t=0,i=0;t<h&&!(m>=d);t+=1,i+=g+l){const t=e[m++],r=o(t,{width:g,height:u});p.image(t,i,n,r.width,r.height)}return p.pop(),p})(t,e),s=((e,t)=>{const n=r(e,t);return{width:e.width*n,height:e.height*n}})(i,n);ne=()=>{n.background(255),n.image(i,n.width/2,n.height/2,s.width,s.height)},ne(),ee=i},re=()=>{if(te)return;const{parameters:e}=U,t=e.rows*e.columns;if(t<1)return;const i=n.shuffle(Q).slice(0,t);i.length<=0||(te=!0,n.cursor(n.WAIT),Z.style("cursor","wait"),_.style("cursor","wait"),((e,t)=>{if(e.length<=0)return void(t.onEnd&&t.onEnd(e));const n=Object.assign(Object.create(u),t),{getAlt:i,hide:o,onLoadEach:r,onFailEach:s,warnOnFail:h,onSuccess:a,onEnd:l}=n;let c=n.onFailAny;const p=e.length,w=[];let m=0;for(let t=0;t<e.length;t+=1){const n=e[t];d({file:n,alt:i(n),hide:o,onLoad:(n,i)=>{r(n,i,t),w.push(n),w.length===p&&a(w),m+=1,m===p&&l(e)},onFail:n=>{s(n,t),c(e),c=g,m+=1,m===p&&l(e)},warnOnFail:h})}})(i,{hide:!0,warnOnFail:!0,onSuccess:oe(e),onEnd:ie}))},se=()=>{ee&&n.save(ee,U.parameters.fileName)},he=()=>{const e=(e=>{const{position:t,size:n,initialColumns:i}=e,o=n.width/i;return{position:t,size:n,columns:i,cellSize:{width:o,height:o},elements:[]}})({position:b,size:F,initialColumns:4}),t=(e,t)=>{e.style("pointer-events","none"),Q.push(t)};(e=>{const{position:t,size:i,onDrop:o}=e,r=n.createDiv("Drop image files here"),s=()=>{r.style("background-color","#FDFDFD"),r.style("cursor","auto")};a(r,t).size(i.width,i.height),r.addClass("drop-zone");const h=r.elt;r.dragOver(()=>{r.style("background-color","#F0FAFF"),r.style("cursor","wait")}).dragLeave(s).drop(o,()=>{s(),h.innerHTML=""}),s()})({position:y,size:v,onDrop:n=>((e,t,n)=>{"image"===t.type?d({file:t,alt:t.name,onLoad:(t,i)=>{q(e,t),n(t,i)}}).hide():console.warn("Dropped file that is not an image:",t)})(e,n,t)})},ae=()=>{switch((()=>{const e=window.navigator.userAgent.toLowerCase();return-1!==e.indexOf("msie")||-1!==e.indexOf("trident")?i.IE:-1!==e.indexOf("edge")?i.Edge:-1!==e.indexOf("chrome")?i.Chrome:-1!==e.indexOf("safari")?i.Safari:-1!==e.indexOf("firefox")?i.FireFox:-1!==e.indexOf("opera")?i.Opera:i.Other})()){case i.IE:return n.createP("Internet Explorer is not supported."),n.createP("Please use another browser."),!1;case i.Edge:return n.createP("Microsoft Edge is not supported."),n.createP("Please use another browser."),!1;default:return!0}},le=()=>{if(!ae())return;const{width:e,height:t}=N,i=n.createCanvas(e,t);a(i,D),window.addEventListener("dragover",e=>{e.preventDefault()},!1),window.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation()},!1),n.imageMode(n.CENTER),he(),Z=c({label:"generate",onClick:re,position:x,size:E,cursor:"pointer"}),_=c({label:"save",onClick:se,position:M,size:O,cursor:"pointer"}),U=G({onMouseEnter:e=>{K(e.parameters)},onMouseLeave:()=>{ne()},onChange:e=>{ne(),K(e.parameters)}}),n.background(255),K(W)};new e(e=>{(e=>n=e)(e),n.setup=le},document.getElementById("ImageGridResult")||document.body)}(p5,jsyaml);