/**
 * Image Grid Generator.
 * @copyright FAL
 * @version 0.1.0
 */
!function(t){"use strict";let e;t=t&&t.hasOwnProperty("default")?t.default:t;const i=t=>t.size(),o="absolute",n=(t,e,i=o)=>{const n=t.elt.style,{x:r,y:h}=e;return n.position=i,n.left=`${r}px`,n.top=`${h}px`,t},r=(t,e,o)=>{((t,e)=>{const{width:o,height:n}=i(t),r=Math.min(e.width/o,e.height/n);t.size(o*r,n*r)})(t,o);const r=i(t);n(t,{x:e.x+(o.width-r.width)/2,y:e.y+(o.height-r.height)/2})},h=t=>{const{label:i,onClick:o,position:r,size:h,cursor:l}=t,s=e.createButton(i);return s.mouseClicked(o),n(s,r),s.size(h.width,h.height),l&&s.style("cursor",l),s},l=t=>{const{file:{data:i},alt:o,hide:n}=t,r=e.createImg(i,o,()=>{const{file:e,warnOnFail:i,onLoad:o,onFail:n}=t;if(!r)return i&&console.warn(`"Failed to load ${e.name}`),void(n&&n(e));o&&o(r,e)});return n&&r.hide(),r},s=()=>{},a=()=>void 0,c=1280,d=800,g=0,u={width:c-d,height:d},p={x:g,y:0},m={width:u.width-20,height:420},w={x:p.x+1,y:p.y+1},f={width:m.width-2,height:m.height-2},y={x:g,y:p.y+m.height+20},v={width:120,height:40},b={x:y.x+16+v.width,y:y.y},F={width:120,height:40},M={x:g,y:y.y+40+20},C={width:u.width-20,height:u.height-(m.height+20+40+20)},z={width:c-u.width,height:d},x={x:u.width,y:0},k=(t,e,i,o,n)=>{const h=Math.floor(e/o),l=e%o,s={x:i.x+n.width*l,y:i.y+n.height*h};r(t,s,n)},I=(t,e)=>{const{position:i,size:o,cellSize:n,columns:r,elements:h}=t;e.show(),k(e,h.length,i,r,n),t.elements.push(e),Math.ceil(h.length/r)*n.height>o.height&&((t,e)=>{const{position:i,size:o,elements:n}=t;t.columns=e;const r=o.width/e;t.cellSize={width:r,height:r};for(let o=0;o<n.length;o+=1)k(n[o],o,i,e,t.cellSize)})(t,r+1)},E={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",fileName:"image-grid.png"},L=(t=>JSON.stringify(t,void 0,2))(E),N=(t,e)=>""===t||isFinite(e)||"object"==typeof e&&!Array.isArray(e)||"string"==typeof e?e:void 0,W=(t,e,i=-1e4,o=1e4)=>{const n=parseInt(t);return Number.isFinite(n)&&n>=i&&n<=o?n:e},O=(t,e,i=100)=>{const o=t.toString();return"string"==typeof o&&o.length>0&&o.length<=i?o:e},T=t=>{return{width:W(t.width,E.width,1),height:W(t.height,E.height,1),columns:W(t.columns,E.columns,1),rows:W(t.rows,E.rows,1),outerMargin:(t=>{const e=E.outerMargin;if("number"==typeof t){const i=W(t,e.top);return{top:i,bottom:i,left:i,right:i}}return{top:W(t.top,e.top),bottom:W(t.bottom,e.bottom),left:W(t.left,e.left),right:W(t.right,e.right)}})(t.outerMargin),innerMargin:W(t.innerMargin,E.innerMargin),backgroundColorCode:O(t.backgroundColorCode,E.backgroundColorCode),fileName:O(t.fileName,E.fileName)}},A=t=>{const{width:e,height:i,columns:o,rows:n,outerMargin:r,innerMargin:h}=t,l=t.width-r.left-r.right,s=t.height-r.top-r.bottom;return{contentWidth:l,contentHeight:s,contentLeftX:r.left,contentTopY:r.top,contentRightX:e-r.right,contentBottomY:i-r.bottom,columnWidth:l/o,rowHeight:s/n,cellWidth:(l-(o-1)*h)/o,cellHeight:(s-(n-1)*h)/n}},D=()=>{},H=t=>{const i=t.onChange||D,o=t.onMouseEnter||D,r=t.onMouseLeave||D,h=(t=>{const{position:i,size:o,initialValue:r}=t,h=e.createElement("textarea",r);return n(h,i).size(o.width,o.height),h})({position:M,size:C,initialValue:L}),l={element:h,contentText:L,parameters:E,monitorIntervalId:void 0},s=()=>{const t=h.value().toString();t!==l.contentText&&(l.contentText=t,l.parameters=(t=>{if("string"!=typeof t)return E;try{return T(JSON.parse(t,N))}catch(t){return E}})(t),i(l))};return h.elt.addEventListener("focus",()=>{l.monitorIntervalId=setInterval(s,100)}),h.elt.addEventListener("blur",()=>{const{monitorIntervalId:t}=l;t&&(clearInterval(t),l.monitorIntervalId=void 0)}),h.elt.addEventListener("mouseenter",o.bind(void 0,l)),h.elt.addEventListener("mouseleave",r.bind(void 0,l)),l},S=t=>{const{width:i,height:o,columns:n,rows:r,innerMargin:h}=t,{contentWidth:l,contentHeight:s,contentLeftX:a,contentTopY:c,contentRightX:d,contentBottomY:g,columnWidth:u,rowHeight:p,cellWidth:m,cellHeight:w}=A(t);if(e.push(),e.translate((e.width-i)/2,(e.height-o)/2),e.stroke(255,64,128),e.noFill(),e.rect(1,1,i-2,o-2),e.rect(a+1,c+1,l-2,s-2),h<=0){for(let t=1,i=a;t<n;t+=1)i+=u,e.line(i,c,i,g);for(let t=1,i=c;t<r;t+=1)i+=p,e.line(a,i,d,i)}else{for(let t=1,i=a;t<n;t+=1)i+=m,e.line(i,c,i,g),i+=h,e.line(i,c,i,g);for(let t=1,i=c;t<r;t+=1)i+=w,e.line(a,i,d,i),i+=h,e.line(a,i,d,i)}e.pop()},R=[];let B,X,Y,$=void 0,G=!1,J=()=>{e.background(255),e.push(),e.stroke(224),e.noFill(),e.strokeWeight(1),e.rect(1,1,e.width-2,e.height-2),e.pop()};const V=()=>{G=!1,e.cursor(e.ARROW),X.style("cursor","pointer"),Y.style("cursor","pointer")},j=t=>i=>{if(i.length<=0)return void V();const o=((t,i)=>{const{width:o,height:n,rows:r,columns:h,outerMargin:l,innerMargin:s,backgroundColorCode:a}=i,c=t.length,{cellWidth:d,cellHeight:g}=A(i),u=e.createGraphics(o,n),p=e.color(a);e.alpha(p)>0&&u.background(p),u.push(),u.imageMode(e.CENTER),u.translate(l.left+d/2,l.top+g/2);let m=0;for(let e=0,i=0;e<r;e+=1,i+=g+s)for(let e=0,o=0;e<h&&!(m>=c);e+=1,o+=d+s){const e=t[m++],n=e.width,r=e.height,h=Math.min(d/n,g/r);u.image(e,o,i,h*n,h*r)}return u.pop(),u})(i,t),n=Math.min(1,Math.min(e.width/o.width,e.height/o.height)),r=n*o.width,h=n*o.height;J=()=>{e.background(255),e.image(o,e.width/2,e.height/2,r,h)},J(),$=o,V()},P=()=>{if(G)return;const{parameters:t}=B,i=t.rows*t.columns;if(i<1)return;const o=e.shuffle(R).slice(0,i);o.length<=0||(G=!0,e.cursor(e.WAIT),X.style("cursor","wait"),Y.style("cursor","wait"),(t=>{const{files:e,hide:i,warnOnFail:o}=t;if(e.length<=0)return;const n=t.getAlt||a,r=t.onLoadEach||s,h=t.onFailEach||s,c=t.onComplete||s;let d=t.onFailAny||s;const g=e.length,u=[];for(let t=0;t<e.length;t+=1){const a=e[t];l({file:a,alt:n(a),hide:i,onLoad:(e,i)=>{r(e,i,t),u.push(e),u.length===g&&c(u)},onFail:i=>{h(i,t),d(e),d=s},warnOnFail:o})}})({files:o,hide:!0,warnOnFail:!0,onComplete:j(t),onFailAny:V}))},q=()=>{$&&e.save($,B.parameters.fileName)},K=()=>{const t=(t=>{const{position:e,size:i,initialColumns:o}=t,n=i.width/o;return{position:e,size:i,columns:o,cellSize:{width:n,height:n},elements:[]}})({position:w,size:f,initialColumns:4}),i=(t,e)=>{t.style("pointer-events","none"),R.push(e)};(t=>{const{position:i,size:o,onDrop:r}=t,h=e.createDiv("Drop image files here"),l=()=>h.style("background-color","#FDFDFD");n(h,i).size(o.width,o.height),h.addClass("drop-zone"),h.dragOver(()=>h.style("background-color","#F0FAFF")).dragLeave(l).drop(r,()=>{l(),h.elt.innerHTML=""}),l()})({position:p,size:m,onDrop:e=>((t,e,i)=>{"image"===e.type?l({file:e,alt:e.name,onLoad:(e,o)=>{I(t,e),i(e,o)}}).hide():console.warn("Dropped file that is not an image:",e)})(t,e,i)})},Q=()=>{const{width:t,height:i}=z,o=e.createCanvas(t,i);n(o,x),e.imageMode(e.CENTER),K(),X=h({label:"generate",onClick:P,position:y,size:v,cursor:"pointer"}),Y=h({label:"save",onClick:q,position:b,size:F,cursor:"pointer"}),B=H({onMouseEnter:t=>{S(t.parameters)},onMouseLeave:()=>{J()},onChange:t=>{J(),S(t.parameters)}}),e.background(255),S(E)};new t(t=>{(t=>e=t)(t),e.setup=Q},document.getElementById("ImageGridResult")||document.body)}(p5);