/**
 * Image Grid Generator.
 * @copyright FAL
 * @version 0.1.0
 */
!function(t){"use strict";let e;t=t&&t.hasOwnProperty("default")?t.default:t;const i=t=>t.size(),o="absolute",n=(t,e,i=o)=>{const n=t.elt.style,{x:h,y:r}=e;return n.position=i,n.left=`${h}px`,n.top=`${r}px`,t},h=(t,e,o)=>{((t,e)=>{const{width:o,height:n}=i(t),h=Math.min(e.width/o,e.height/n);t.size(o*h,n*h)})(t,o);const h=i(t);n(t,{x:e.x+(o.width-h.width)/2,y:e.y+(o.height-h.height)/2})},r=t=>{const{label:i,onClick:o,position:h,size:r}=t,l=e.createButton(i);return l.mouseClicked(o),n(l,h),l.size(r.width,r.height),l},l=t=>{const{file:{data:i},alt:o,hide:n}=t,h=e.createImg(i,o,()=>{const{file:e,warnOnFail:i,onLoad:o,onFail:n}=t;if(!h)return i&&console.warn(`"Failed to load ${e.name}`),void(n&&n(e));o&&o(h,e)});return n&&h.hide(),h},s=()=>{},a=()=>void 0,g=1280,c=800,d=0,u={width:g-c,height:c},p={x:d,y:0},w={width:u.width-20,height:420},m={x:p.x+1,y:p.y+1},f={width:w.width-2,height:w.height-2},y={x:d,y:p.y+w.height+20},b={width:120,height:40},F={x:y.x+16+b.width,y:y.y},z={width:120,height:40},C={x:d,y:y.y+40+20},M={width:u.width-20,height:u.height-(w.height+20+40+20)},v={width:g-u.width,height:c},k={x:u.width,y:0},x=(t,e,i,o,n)=>{const r=Math.floor(e/o),l=e%o,s={x:i.x+n.width*l,y:i.y+n.height*r};h(t,s,n)},E=(t,e)=>{const{position:i,size:o,cellSize:n,columns:h,elements:r}=t;e.show(),x(e,r.length,i,h,n),t.elements.push(e),Math.ceil(r.length/h)*n.height>o.height&&((t,e)=>{const{position:i,size:o,elements:n}=t;t.columns=e;const h=o.width/e;t.cellSize={width:h,height:h};for(let o=0;o<n.length;o+=1)x(n[o],o,i,e,t.cellSize)})(t,h+1)},L={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00"},W=(t=>JSON.stringify(t,void 0,2))(L),O=(t,e)=>""===t||Number.isFinite(e)||"object"==typeof e&&!Array.isArray(e)||"string"==typeof e?e:void 0,S=(t,e)=>Number.isFinite(t)&&t<1e4?t:e,D=t=>{return{width:S(t.width,L.width),height:S(t.height,L.height),columns:S(t.columns,L.columns),rows:S(t.rows,L.rows),outerMargin:(t=>{const e=L.outerMargin;if("number"==typeof t){const i=S(t,e.top);return{top:i,bottom:i,left:i,right:i}}return{top:S(t.top,e.top),bottom:S(t.bottom,e.bottom),left:S(t.left,e.left),right:S(t.right,e.right)}})(t.outerMargin),innerMargin:S(t.innerMargin,L.innerMargin),backgroundColorCode:((t,e)=>"string"==typeof t?t:e)(t.backgroundColorCode,L.backgroundColorCode)}},H=t=>{if("string"!=typeof t)return L;try{return D(JSON.parse(t,O))}catch(t){return L}},R=t=>{const{width:e,height:i,columns:o,rows:n,outerMargin:h,innerMargin:r}=t,l=t.width-h.left-h.right,s=t.height-h.top-h.bottom;return{contentWidth:l,contentHeight:s,contentLeftX:h.left,contentTopY:h.top,contentRightX:e-h.right,contentBottomY:i-h.bottom,columnWidth:l/o,rowHeight:s/n,cellWidth:(l-(o-1)*r)/o,cellHeight:(s-(n-1)*r)/n}},A=t=>{const{width:i,height:o,columns:n,rows:h,innerMargin:r}=t,{contentWidth:l,contentHeight:s,contentLeftX:a,contentTopY:g,contentRightX:c,contentBottomY:d,columnWidth:u,rowHeight:p,cellWidth:w,cellHeight:m}=R(t);if(e.push(),e.translate((e.width-i)/2,(e.height-o)/2),e.stroke(255,64,128),e.noFill(),e.rect(1,1,i-2,o-2),e.rect(a+1,g+1,l-2,s-2),r<=0){for(let t=1,i=a;t<n;t+=1)i+=u,e.line(i,g,i,d);for(let t=1,i=g;t<h;t+=1)i+=p,e.line(a,i,c,i)}else{for(let t=1,i=a;t<n;t+=1)i+=w,e.line(i,g,i,d),i+=r,e.line(i,g,i,d);for(let t=1,i=g;t<h;t+=1)i+=m,e.line(a,i,c,i),i+=r,e.line(a,i,c,i)}e.pop()},N=[];let T,I=void 0,B=!1,X=!1,Y=()=>{e.background(255),e.push(),e.stroke(224),e.noFill(),e.strokeWeight(1),e.rect(1,1,e.width-2,e.height-2),e.pop()};const $=()=>{X=!1,e.cursor(e.ARROW)},G=t=>i=>{if(i.length<=0)return void $();const o=((t,i)=>{const{width:o,height:n,rows:h,columns:r,outerMargin:l,innerMargin:s,backgroundColorCode:a}=i,g=t.length,{cellWidth:c,cellHeight:d}=R(i),u=e.createGraphics(o,n),p=e.color(a);e.alpha(p)>0&&u.background(p),u.push(),u.imageMode(e.CENTER),u.translate(l.left+c/2,l.top+d/2);let w=0;for(let e=0,i=0;e<h;e+=1,i+=d+s)for(let e=0,o=0;e<r&&!(w>=g);e+=1,o+=c+s){const e=t[w++],n=e.width,h=e.height,r=Math.min(c/n,d/h);u.image(e,o,i,r*n,r*h)}return u.pop(),u})(i,t),n=Math.min(1,Math.min(e.width/o.width,e.height/o.height)),h=n*o.width,r=n*o.height;Y=()=>{e.background(255),e.image(o,e.width/2,e.height/2,h,r)},Y(),I=o,$()},J=()=>{if(X)return;const t=H(T.value().toString()),i=t.rows*t.columns;i<1||(X=!0,X=!0,e.cursor(e.WAIT),(t=>{const{files:e,hide:i,warnOnFail:o}=t,n=t.getAlt||a,h=t.onLoadEach||s,r=t.onFailEach||s,g=t.onComplete||s,c=e.length,d=[];for(let t=0;t<e.length;t+=1){const s=e[t];l({file:s,alt:n(s),hide:i,onLoad:(e,i)=>{h(e,i,t),d.push(e),d.length===c&&g(d)},onFail:e=>r(e,t),warnOnFail:o})}})({files:e.shuffle(N).slice(0,i),hide:!0,warnOnFail:!0,onComplete:G(t)}))},V=()=>{I&&e.save(I,"grid-image.png")},j=()=>{const t=(t=>{const{position:e,size:i,initialColumns:o}=t,n=i.width/o;return{position:e,size:i,columns:o,cellSize:{width:n,height:n},elements:[]}})({position:m,size:f,initialColumns:4}),i=(t,e)=>{t.style("pointer-events","none"),N.push(e)};(t=>{const{position:i,size:o,onDrop:h}=t,r=e.createDiv("Drop image files here"),l=()=>r.style("background-color","#FDFDFD");n(r,i).size(o.width,o.height),r.addClass("drop-zone"),r.dragOver(()=>r.style("background-color","#F0FAFF")).dragLeave(l).drop(h,()=>{l(),r.elt.innerHTML=""}),l()})({position:p,size:w,onDrop:e=>((t,e,i)=>{"image"===e.type?l({file:e,alt:e.name,onLoad:(e,o)=>{E(t,e),i(e,o)}}).hide():console.warn("Dropped file that is not an image:",e)})(t,e,i)})},P=()=>{T=(t=>{const{position:i,size:o,initialValue:h}=t,r=e.createElement("textarea",h);return n(r,i).size(o.width,o.height),r})({position:C,size:M,initialValue:W}),T.elt.addEventListener("mouseenter",()=>{B=!0,A(H(T.value().toString()))}),T.elt.addEventListener("mouseleave",()=>{B=!1,Y()});let t=W;setInterval(()=>{if(!B)return;const e=T.value().toString();e!==t&&(Y(),A(H(e)),t=e)},100)},q=()=>{const{width:t,height:i}=v,o=e.createCanvas(t,i);n(o,k),e.imageMode(e.CENTER),j(),r({label:"generate",onClick:J,position:y,size:b}).style("font-size","large"),r({label:"save",onClick:V,position:F,size:z}).style("font-size","large"),P(),e.background(255),A(L)};new t(t=>{(t=>e=t)(t),e.setup=q},document.getElementById("ImageGridResult")||document.body)}(p5);