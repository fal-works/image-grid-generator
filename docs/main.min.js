/**
 * Image Grid Generator.
 * @copyright FAL
 * @version 1.0.1
 */
!function(t){"use strict";let e;t=t&&t.hasOwnProperty("default")?t.default:t;const i=(t,e)=>{const i=((t,e)=>{const{width:i,height:o}=t;return Math.min(e.width/i,e.height/o)})(t,e);return{width:t.width*i,height:t.height*i}},o=(t,e)=>{const{width:i,height:o}=t;return Math.min(1,Math.min(e.width/i,e.height/o))},n=t=>t.size(),r="absolute",h=(t,e,i=r)=>{const o=t.elt.style,{x:n,y:h}=e;return o.position=i,o.left=`${n}px`,o.top=`${h}px`,t},s=(t,e,o)=>{((t,e)=>{const o=i(n(t),e);t.size(o.width,o.height)})(t,o);const r=n(t);h(t,{x:e.x+(o.width-r.width)/2,y:e.y+(o.height-r.height)/2})},l=t=>{const{label:i,onClick:o,position:n,size:r,cursor:s}=t,l=e.createButton(i);return l.mouseClicked(o),h(l,n),l.size(r.width,r.height),s&&l.style("cursor",s),l},a=t=>{const{file:{data:i},alt:o,hide:n}=t,r=e.createImg(i,o,()=>{const{file:e,warnOnFail:i,onLoad:o,onFail:n}=t;if(!r)return i&&console.warn(`"Failed to load ${e.name}`),void(n&&n(e));o&&o(r,e)});return n&&r.hide(),r},c=()=>{},d=()=>void 0,g=1280,u=800,p=0,w={width:g-u,height:u},m={x:p,y:0},f={width:w.width-20,height:420},y={x:m.x+1,y:m.y+1},v={width:f.width-2,height:f.height-2},b={x:p,y:m.y+f.height+20},F={width:120,height:40},M={x:b.x+16+F.width,y:b.y},C={width:120,height:40},z={x:p,y:b.y+40+20},k={width:w.width-20,height:w.height-(f.height+20+40+20)},x={width:g-w.width,height:u},E={x:w.width,y:0},L={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",fileName:"image-grid.png"},I=(t=>JSON.stringify(t,void 0,2))(L),O=(t,e)=>""===t||isFinite(e)||"object"==typeof e&&!Array.isArray(e)||"string"==typeof e?e:void 0,W=(t,e,i=-1e4,o=1e4)=>{const n=parseInt(t);return Number.isFinite(n)&&n>=i&&n<=o?n:e},D=(t,e,i=100)=>{const o=t.toString();return"string"==typeof o&&o.length>0&&o.length<=i?o:e},N=t=>{return{width:W(t.width,L.width,1),height:W(t.height,L.height,1),columns:W(t.columns,L.columns,1),rows:W(t.rows,L.rows,1),outerMargin:(t=>{const e=L.outerMargin;if("number"==typeof t){const i=W(t,e.top);return{top:i,bottom:i,left:i,right:i}}return{top:W(t.top,e.top),bottom:W(t.bottom,e.bottom),left:W(t.left,e.left),right:W(t.right,e.right)}})(t.outerMargin),innerMargin:W(t.innerMargin,L.innerMargin),backgroundColorCode:D(t.backgroundColorCode,L.backgroundColorCode),fileName:D(t.fileName,L.fileName)}},T=t=>{const{width:e,height:i,columns:o,rows:n,outerMargin:r,innerMargin:h}=t,s=t.width-r.left-r.right,l=t.height-r.top-r.bottom;return{contentWidth:s,contentHeight:l,contentLeftX:r.left,contentTopY:r.top,contentRightX:e-r.right,contentBottomY:i-r.bottom,columnWidth:s/o,rowHeight:l/n,cellWidth:(s-(o-1)*h)/o,cellHeight:(l-(n-1)*h)/n}},A=()=>{},H={onChange:A,onMouseEnter:A,onMouseLeave:A},S=t=>{const{onChange:i,onMouseEnter:o,onMouseLeave:n}=Object.assign(Object.create(H),t),r=(t=>{const{position:i,size:o,initialValue:n}=t,r=e.createElement("textarea",n);return h(r,i).size(o.width,o.height),r})({position:z,size:k,initialValue:I}),s={element:r,contentText:I,parameters:L,monitorIntervalId:void 0},l=()=>{const t=r.value().toString();t!==s.contentText&&(s.contentText=t,s.parameters=(t=>{if("string"!=typeof t)return L;try{return N(JSON.parse(t,O))}catch(t){return L}})(t),i(s))};return r.elt.addEventListener("focus",()=>{s.monitorIntervalId=setInterval(l,100)}),r.elt.addEventListener("blur",()=>{const{monitorIntervalId:t}=s;t&&(clearInterval(t),s.monitorIntervalId=void 0)}),r.elt.addEventListener("mouseenter",o.bind(void 0,s)),r.elt.addEventListener("mouseleave",n.bind(void 0,s)),s},R=(t,e,i,o,n)=>{const r=Math.floor(e/o),h=e%o,l={x:i.x+n.width*h,y:i.y+n.height*r};s(t,l,n)},B=(t,e)=>{const{position:i,size:o,cellSize:n,columns:r,elements:h}=t;e.show(),R(e,h.length,i,r,n),t.elements.push(e),Math.ceil(h.length/r)*n.height>o.height&&((t,e)=>{const{position:i,size:o,elements:n}=t;t.columns=e;const r=o.width/e;t.cellSize={width:r,height:r};for(let o=0;o<n.length;o+=1)R(n[o],o,i,e,t.cellSize)})(t,r+1)},X=t=>{const{width:i,height:n,columns:r,rows:h,innerMargin:s}=t,{contentWidth:l,contentHeight:a,contentLeftX:c,contentTopY:d,contentRightX:g,contentBottomY:u,columnWidth:p,rowHeight:w,cellWidth:m,cellHeight:f}=T(t);e.push(),e.translate(e.width/2,e.height/2);const y=o(t,e);if(e.scale(y),e.strokeWeight(1/y),e.translate(-i/2,-n/2),e.stroke(255,64,128),e.noFill(),e.rect(1,1,i-2,n-2),e.rect(c+1,d+1,l-2,a-2),0===s){for(let t=1,i=c;t<r;t+=1)i+=p,e.line(i,d,i,u);for(let t=1,i=d;t<h;t+=1)i+=w,e.line(c,i,g,i)}else{for(let t=1,i=c;t<r;t+=1)i+=m,e.line(i,d,i,u),i+=s,e.line(i,d,i,u);for(let t=1,i=d;t<h;t+=1)i+=f,e.line(c,i,g,i),i+=s,e.line(c,i,g,i)}e.pop()},Y=[];let j,$,G,J=void 0,P=!1,V=()=>{e.background(255),e.push(),e.stroke(224),e.noFill(),e.strokeWeight(1),e.rect(1,1,e.width-2,e.height-2),e.pop()};const q=()=>{P=!1,e.cursor(e.ARROW),$.style("cursor","pointer"),G.style("cursor","pointer")},K=t=>n=>{if(n.length<=0)return void q();const r=((t,o)=>{const{width:n,height:r,rows:h,columns:s,outerMargin:l,innerMargin:a,backgroundColorCode:c}=o,d=t.length,{cellWidth:g,cellHeight:u}=T(o),p=e.createGraphics(n,r),w=e.color(c);e.alpha(w)>0&&p.background(w),p.push(),p.imageMode(e.CENTER),p.translate(l.left+g/2,l.top+u/2);let m=0;for(let e=0,o=0;e<h;e+=1,o+=u+a)for(let e=0,n=0;e<s&&!(m>=d);e+=1,n+=g+a){const e=t[m++],r=i(e,{width:g,height:u});p.image(e,n,o,r.width,r.height)}return p.pop(),p})(n,t),h=((t,e)=>{const i=o(t,e);return{width:t.width*i,height:t.height*i}})(r,e);V=()=>{e.background(255),e.image(r,e.width/2,e.height/2,h.width,h.height)},V(),J=r,q()},Q=()=>{if(P)return;const{parameters:t}=j,i=t.rows*t.columns;if(i<1)return;const o=e.shuffle(Y).slice(0,i);o.length<=0||(P=!0,e.cursor(e.WAIT),$.style("cursor","wait"),G.style("cursor","wait"),(t=>{const{files:e,hide:i,warnOnFail:o}=t;if(e.length<=0)return;const n=t.getAlt||d,r=t.onLoadEach||c,h=t.onFailEach||c,s=t.onComplete||c;let l=t.onFailAny||c;const g=e.length,u=[];for(let t=0;t<e.length;t+=1){const d=e[t];a({file:d,alt:n(d),hide:i,onLoad:(e,i)=>{r(e,i,t),u.push(e),u.length===g&&s(u)},onFail:i=>{h(i,t),l(e),l=c},warnOnFail:o})}})({files:o,hide:!0,warnOnFail:!0,onComplete:K(t),onFailAny:q}))},U=()=>{J&&e.save(J,j.parameters.fileName)},Z=()=>{const t=(t=>{const{position:e,size:i,initialColumns:o}=t,n=i.width/o;return{position:e,size:i,columns:o,cellSize:{width:n,height:n},elements:[]}})({position:y,size:v,initialColumns:4}),i=(t,e)=>{t.style("pointer-events","none"),Y.push(e)};(t=>{const{position:i,size:o,onDrop:n}=t,r=e.createDiv("Drop image files here"),s=()=>{r.style("background-color","#FDFDFD"),r.style("cursor","auto")};h(r,i).size(o.width,o.height),r.addClass("drop-zone"),r.dragOver(()=>{r.style("background-color","#F0FAFF"),r.style("cursor","wait")}).dragLeave(s).drop(n,()=>{s(),r.elt.innerHTML=""}),s()})({position:m,size:f,onDrop:e=>((t,e,i)=>{"image"===e.type?a({file:e,alt:e.name,onLoad:(e,o)=>{B(t,e),i(e,o)}}).hide():console.warn("Dropped file that is not an image:",e)})(t,e,i)})},_=()=>{const{width:t,height:i}=x,o=e.createCanvas(t,i);h(o,E),window.addEventListener("dragover",t=>{t.preventDefault()},!1),window.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation()},!1),e.imageMode(e.CENTER),Z(),$=l({label:"generate",onClick:Q,position:b,size:F,cursor:"pointer"}),G=l({label:"save",onClick:U,position:M,size:C,cursor:"pointer"}),j=S({onMouseEnter:t=>{X(t.parameters)},onMouseLeave:()=>{V()},onChange:t=>{V(),X(t.parameters)}}),e.background(255),X(L)};new t(t=>{(t=>e=t)(t),e.setup=_},document.getElementById("ImageGridResult")||document.body)}(p5);