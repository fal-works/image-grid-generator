/**
 * Image Grid Generator.
 * @copyright FAL
 * @version 1.0.2
 */
!function(e){"use strict";let t;e=e&&e.hasOwnProperty("default")?e.default:e;var i;!function(e){e[e.IE=0]="IE",e[e.Edge=1]="Edge",e[e.Chrome=2]="Chrome",e[e.Safari=3]="Safari",e[e.FireFox=4]="FireFox",e[e.Opera=5]="Opera",e[e.Other=6]="Other"}(i||(i={}));const o=(e,t)=>{const i=((e,t)=>{const{width:i,height:o}=e;return Math.min(t.width/i,t.height/o)})(e,t);return{width:e.width*i,height:e.height*i}},n=(e,t)=>{const{width:i,height:o}=e;return Math.min(1,Math.min(t.width/i,t.height/o))},r=e=>e.size(),h="absolute",s=(e,t,i=h)=>{const o=e.elt.style,{x:n,y:r}=t;return o.position=i,o.left=`${n}px`,o.top=`${r}px`,e},a=(e,t,i)=>{((e,t)=>{const i=o(r(e),t);e.size(i.width,i.height)})(e,i);const n=r(e);s(e,{x:t.x+(i.width-n.width)/2,y:t.y+(i.height-n.height)/2})},l=e=>{const{label:i,onClick:o,position:n,size:r,cursor:h}=e,a=t.createButton(i);return a.mouseClicked(o),s(a,n),a.size(r.width,r.height),h&&a.style("cursor",h),a},d=e=>{const{file:{data:i},alt:o,hide:n}=e,r=t.createImg(i,o,()=>{const{file:t,warnOnFail:i,onLoad:o,onFail:n}=e;if(!r)return i&&console.warn(`"Failed to load ${t.name}`),void(n&&n(t));o&&o(r,t)});return n&&r.hide(),r},c=()=>{},g=()=>void 0,u=1035,p=640,w=0,m={width:u-p,height:p},f={x:w,y:0},y={width:m.width-20,height:280},v={x:f.x+2,y:f.y+2},b={width:y.width-4,height:y.height-4},F={x:w,y:f.y+y.height+15},x={width:120,height:40},C={x:F.x+16+x.width,y:F.y},M={width:120,height:40},E={x:w,y:F.y+40+15},O={width:m.width-20,height:m.height-(y.height+15+40+15)},z={width:u-m.width,height:p},I={x:m.width,y:0},k={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",fileName:"image-grid.png"},L=(e=>JSON.stringify(e,void 0,2))(k),S=(e,t)=>""===e||isFinite(t)||"object"==typeof t&&!Array.isArray(t)||"string"==typeof t?t:void 0,W=(e,t,i=-1e4,o=1e4)=>{const n=parseInt(e);return Number.isFinite(n)&&n>=i&&n<=o?n:t},D=(e,t,i=100)=>{const o=e.toString();return"string"==typeof o&&o.length>0&&o.length<=i?o:t},N=e=>{return{width:W(e.width,k.width,1),height:W(e.height,k.height,1),columns:W(e.columns,k.columns,1),rows:W(e.rows,k.rows,1),outerMargin:(e=>{const t=k.outerMargin;if("number"==typeof e){const i=W(e,t.top);return{top:i,bottom:i,left:i,right:i}}return{top:W(e.top,t.top),bottom:W(e.bottom,t.bottom),left:W(e.left,t.left),right:W(e.right,t.right)}})(e.outerMargin),innerMargin:W(e.innerMargin,k.innerMargin),backgroundColorCode:D(e.backgroundColorCode,k.backgroundColorCode),fileName:D(e.fileName,k.fileName)}},A=e=>{const{width:t,height:i,columns:o,rows:n,outerMargin:r,innerMargin:h}=e,s=e.width-r.left-r.right,a=e.height-r.top-r.bottom;return{contentWidth:s,contentHeight:a,contentLeftX:r.left,contentTopY:r.top,contentRightX:t-r.right,contentBottomY:i-r.bottom,columnWidth:s/o,rowHeight:a/n,cellWidth:(s-(o-1)*h)/o,cellHeight:(a-(n-1)*h)/n}},T=()=>{},H={onChange:T,onMouseEnter:T,onMouseLeave:T},P=e=>{const{onChange:i,onMouseEnter:o,onMouseLeave:n}=Object.assign(Object.create(H),e),r=(e=>{const{position:i,size:o,initialValue:n}=e,r=t.createElement("textarea",n);return s(r,i).size(o.width,o.height),r})({position:E,size:O,initialValue:L}),h={element:r,contentText:L,parameters:k,monitorIntervalId:void 0},a=()=>{const e=r.value().toString();e!==h.contentText&&(h.contentText=e,h.parameters=(e=>{if("string"!=typeof e)return k;try{return N(JSON.parse(e,S))}catch(e){return k}})(e),i(h))};return r.elt.addEventListener("focus",()=>{h.monitorIntervalId=setInterval(a,100)}),r.elt.addEventListener("blur",()=>{const{monitorIntervalId:e}=h;e&&(clearInterval(e),h.monitorIntervalId=void 0)}),r.elt.addEventListener("mouseenter",o.bind(void 0,h)),r.elt.addEventListener("mouseleave",n.bind(void 0,h)),h},R=(e,t,i,o,n)=>{const r=Math.floor(t/o),h=t%o,s={x:i.x+n.width*h,y:i.y+n.height*r};a(e,s,n)},B=(e,t)=>{const{position:i,size:o,cellSize:n,columns:r,elements:h}=e;t.show(),R(t,h.length,i,r,n),e.elements.push(t),Math.ceil(h.length/r)*n.height>o.height&&((e,t)=>{const{position:i,size:o,elements:n}=e;e.columns=t;const r=o.width/t;e.cellSize={width:r,height:r};for(let o=0;o<n.length;o+=1)R(n[o],o,i,t,e.cellSize)})(e,r+1)},X=e=>{const{width:i,height:o,columns:r,rows:h,innerMargin:s}=e,{contentWidth:a,contentHeight:l,contentLeftX:d,contentTopY:c,contentRightX:g,contentBottomY:u,columnWidth:p,rowHeight:w,cellWidth:m,cellHeight:f}=A(e);t.push(),t.translate(t.width/2,t.height/2);const y=n(e,t);if(t.scale(y),t.strokeWeight(1/y),t.translate(-i/2,-o/2),t.stroke(255,64,128),t.noFill(),t.rect(1,1,i-2,o-2),t.rect(d+1,c+1,a-2,l-2),0===s){for(let e=1,i=d;e<r;e+=1)i+=p,t.line(i,c,i,u);for(let e=1,i=c;e<h;e+=1)i+=w,t.line(d,i,g,i)}else{for(let e=1,i=d;e<r;e+=1)i+=m,t.line(i,c,i,u),i+=s,t.line(i,c,i,u);for(let e=1,i=c;e<h;e+=1)i+=f,t.line(d,i,g,i),i+=s,t.line(d,i,g,i)}t.pop()},Y=[];let j,$,G,J=void 0,V=!1,q=()=>{t.background(255),t.push(),t.stroke(224),t.noFill(),t.strokeWeight(1),t.rect(1,1,t.width-2,t.height-2),t.pop()};const K=()=>{V=!1,t.cursor(t.ARROW),$.style("cursor","pointer"),G.style("cursor","pointer")},Q=e=>i=>{if(i.length<=0)return void K();const r=((e,i)=>{const{width:n,height:r,rows:h,columns:s,outerMargin:a,innerMargin:l,backgroundColorCode:d}=i,c=e.length,{cellWidth:g,cellHeight:u}=A(i),p=t.createGraphics(n,r),w=t.color(d);t.alpha(w)>0&&p.background(w),p.push(),p.imageMode(t.CENTER),p.translate(a.left+g/2,a.top+u/2);let m=0;for(let t=0,i=0;t<h;t+=1,i+=u+l)for(let t=0,n=0;t<s&&!(m>=c);t+=1,n+=g+l){const t=e[m++],r=o(t,{width:g,height:u});p.image(t,n,i,r.width,r.height)}return p.pop(),p})(i,e),h=((e,t)=>{const i=n(e,t);return{width:e.width*i,height:e.height*i}})(r,t);q=()=>{t.background(255),t.image(r,t.width/2,t.height/2,h.width,h.height)},q(),J=r,K()},U=()=>{if(V)return;const{parameters:e}=j,i=e.rows*e.columns;if(i<1)return;const o=t.shuffle(Y).slice(0,i);o.length<=0||(V=!0,t.cursor(t.WAIT),$.style("cursor","wait"),G.style("cursor","wait"),(e=>{const{files:t,hide:i,warnOnFail:o}=e;if(t.length<=0)return;const n=e.getAlt||g,r=e.onLoadEach||c,h=e.onFailEach||c,s=e.onComplete||c;let a=e.onFailAny||c;const l=t.length,u=[];for(let e=0;e<t.length;e+=1){const g=t[e];d({file:g,alt:n(g),hide:i,onLoad:(t,i)=>{r(t,i,e),u.push(t),u.length===l&&s(u)},onFail:i=>{h(i,e),a(t),a=c},warnOnFail:o})}})({files:o,hide:!0,warnOnFail:!0,onComplete:Q(e),onFailAny:K}))},Z=()=>{J&&t.save(J,j.parameters.fileName)},_=()=>{const e=(e=>{const{position:t,size:i,initialColumns:o}=e,n=i.width/o;return{position:t,size:i,columns:o,cellSize:{width:n,height:n},elements:[]}})({position:v,size:b,initialColumns:4}),i=(e,t)=>{e.style("pointer-events","none"),Y.push(t)};(e=>{const{position:i,size:o,onDrop:n}=e,r=t.createDiv("Drop image files here"),h=()=>{r.style("background-color","#FDFDFD"),r.style("cursor","auto")};s(r,i).size(o.width,o.height),r.addClass("drop-zone"),r.dragOver(()=>{r.style("background-color","#F0FAFF"),r.style("cursor","wait")}).dragLeave(h).drop(n,()=>{h(),r.elt.innerHTML=""}),h()})({position:f,size:y,onDrop:t=>((e,t,i)=>{"image"===t.type?d({file:t,alt:t.name,onLoad:(t,o)=>{B(e,t),i(t,o)}}).hide():console.warn("Dropped file that is not an image:",t)})(e,t,i)})},ee=()=>{switch((()=>{const e=window.navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")||-1!=e.indexOf("trident")?i.IE:-1!=e.indexOf("edge")?i.Edge:-1!=e.indexOf("chrome")?i.Chrome:-1!=e.indexOf("safari")?i.Safari:-1!=e.indexOf("firefox")?i.FireFox:(e.indexOf("opera"),i.Opera)})()){case i.IE:return t.createP("Internet Explorer is not supported."),t.createP("Please use another browser."),!1;case i.Edge:return t.createP("Microsoft Edge is not supported."),t.createP("Please use another browser."),!1;default:return!0}},te=()=>{if(!ee())return;const{width:e,height:i}=z,o=t.createCanvas(e,i);s(o,I),window.addEventListener("dragover",e=>{e.preventDefault()},!1),window.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation()},!1),t.imageMode(t.CENTER),_(),$=l({label:"generate",onClick:U,position:F,size:x,cursor:"pointer"}),G=l({label:"save",onClick:Z,position:C,size:M,cursor:"pointer"}),j=P({onMouseEnter:e=>{X(e.parameters)},onMouseLeave:()=>{q()},onChange:e=>{q(),X(e.parameters)}}),t.background(255),X(k)};new e(e=>{(e=>t=e)(e),t.setup=te},document.getElementById("ImageGridResult")||document.body)}(p5);