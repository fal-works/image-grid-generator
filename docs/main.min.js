/**
 * Image Grid Generator.
 * @copyright 2019 FAL
 * @version 1.0.2
 */
!function(e,t){"use strict";let n;e=e&&e.hasOwnProperty("default")?e.default:e;var o;!function(e){e[e.IE=0]="IE",e[e.Edge=1]="Edge",e[e.Chrome=2]="Chrome",e[e.Safari=3]="Safari",e[e.FireFox=4]="FireFox",e[e.Opera=5]="Opera",e[e.Other=6]="Other"}(o||(o={}));const i=(e,t)=>{const n=((e,t)=>{const{width:n,height:o}=e;return Math.min(t.width/n,t.height/o)})(e,t);return{width:e.width*n,height:e.height*n}},r=(e,t)=>{const{width:n,height:o}=e;return Math.min(1,Math.min(t.width/n,t.height/o))},s=e=>e.size(),h="absolute",a=(e,t,n=h)=>{const o=e.elt.style,{x:i,y:r}=t;return o.position=n,o.left=`${i}px`,o.top=`${r}px`,e},l=(e,t,n)=>{((e,t)=>{const n=i(s(e),t);e.size(n.width,n.height)})(e,n);const o=s(e);a(e,{x:t.x+(n.width-o.width)/2,y:t.y+(n.height-o.height)/2})},c=e=>{const{label:t,onClick:o,position:i,size:r,cursor:s}=e,h=n.createButton(t);return h.mouseClicked(o),a(h,i),h.size(r.width,r.height),s&&h.style("cursor",s),h},d=e=>{const{file:{data:t},alt:o,hide:i}=e,r=n.createImg(t,o,()=>{const{file:t,warnOnFail:n,onLoad:o,onFail:i}=e;if(!r)return n&&console.warn(`"Failed to load ${t.name}`),void(i&&i(t));o&&o(r,t)});return i&&r.hide(),r},g=()=>{},u={getAlt:()=>void 0,hide:!1,onLoadEach:g,onFailEach:g,warnOnFail:!0,onSuccess:g,onFailAny:g,onEnd:g},p=1035,w=640,m=0,f={width:p-w,height:w},y={x:m,y:0},v={width:f.width-20,height:280},b={x:y.x+2,y:y.y+2},F={width:v.width-4,height:v.height-4},E={x:m,y:y.y+v.height+15},x={width:120,height:40},M={x:E.x+16+x.width,y:E.y},C={width:120,height:40},O={x:m,y:E.y+40+15},z={width:f.width-20,height:f.height-(v.height+15+40+15)},I={width:p-f.width,height:w},L={x:f.width,y:0},k={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",fileName:"image-grid.png"},S=(e=>t.safeDump(e))(k),A=(e,t)=>""===e||isFinite(t)||"object"==typeof t&&!Array.isArray(t)||"string"==typeof t?t:void 0,D=(e,t,n=-1e4,o=1e4)=>{const i=parseInt(e);return Number.isFinite(i)&&i>=n&&i<=o?i:t},W="[\\da-fA-F]",N=new RegExp(`^(${W}{3}|${W}{4}|${W}{6}|${W}{8})$`),T=e=>{return{width:D(e.width,k.width,1),height:D(e.height,k.height,1),columns:D(e.columns,k.columns,1),rows:D(e.rows,k.rows,1),outerMargin:(e=>{const t=k.outerMargin;if("number"==typeof e){const n=D(e,t.top);return{top:n,bottom:n,left:n,right:n}}return{top:D(e.top,t.top),bottom:D(e.bottom,t.bottom),left:D(e.left,t.left),right:D(e.right,t.right)}})(e.outerMargin),innerMargin:D(e.innerMargin,k.innerMargin),backgroundColorCode:((e,t)=>{const n=e.toString();return"string"==typeof n?n.match(N)?`#${n}`:n:t})(e.backgroundColorCode,k.backgroundColorCode),fileName:((e,t,n=100)=>{const o=e.toString();return"string"==typeof o&&o.length>0&&o.length<=n?o:t})(e.fileName,k.fileName,255)}},$=e=>{const{width:t,height:n,columns:o,rows:i,outerMargin:r,innerMargin:s}=e,h=e.width-r.left-r.right,a=e.height-r.top-r.bottom;return{contentWidth:h,contentHeight:a,contentLeftX:r.left,contentTopY:r.top,contentRightX:t-r.right,contentBottomY:n-r.bottom,columnWidth:h/o,rowHeight:a/i,cellWidth:(h-(o-1)*s)/o,cellHeight:(a-(i-1)*s)/i}},H=()=>{},P={onChange:H,onMouseEnter:H,onMouseLeave:H},R=e=>{const{onChange:o,onMouseEnter:i,onMouseLeave:r}=Object.assign(Object.create(P),e),s=(e=>{const{position:t,size:o,initialValue:i}=e,r=n.createElement("textarea",i);return a(r,t).size(o.width,o.height),r})({position:O,size:z,initialValue:S}),h={element:s,contentText:S,parameters:k,monitorIntervalId:void 0},l=()=>{const e=s.value().toString();e!==h.contentText&&(h.contentText=e,h.parameters=(e=>{if("string"!=typeof e)return k;const n=e.trim();try{return"{"===n.substr(0,1)?T(JSON.parse(n,A)):T(t.safeLoad(n))}catch(e){return k}})(e),o(h))};return s.elt.addEventListener("focus",()=>{h.monitorIntervalId=setInterval(l,100)}),s.elt.addEventListener("blur",()=>{const{monitorIntervalId:e}=h;e&&(clearInterval(e),h.monitorIntervalId=void 0)}),s.elt.addEventListener("mouseenter",i.bind(void 0,h)),s.elt.addEventListener("mouseleave",r.bind(void 0,h)),h},j=(e,t,n,o,i)=>{const r=Math.floor(t/o),s=t%o,h={x:n.x+i.width*s,y:n.y+i.height*r};l(e,h,i)},B=(e,t)=>{const{position:n,size:o,cellSize:i,columns:r,elements:s}=e;t.show(),j(t,s.length,n,r,i),e.elements.push(t),Math.ceil(s.length/r)*i.height>o.height&&((e,t)=>{const{position:n,size:o,elements:i}=e;e.columns=t;const r=o.width/t;e.cellSize={width:r,height:r};for(let o=0;o<i.length;o+=1)j(i[o],o,n,t,e.cellSize)})(e,r+1)},X=e=>{const{width:t,height:o,columns:i,rows:s,innerMargin:h}=e,{contentWidth:a,contentHeight:l,contentLeftX:c,contentTopY:d,contentRightX:g,contentBottomY:u,columnWidth:p,rowHeight:w,cellWidth:m,cellHeight:f}=$(e);n.push(),n.translate(n.width/2,n.height/2);const y=r(e,n);if(n.scale(y),n.strokeWeight(1/y),n.translate(-t/2,-o/2),n.stroke(255,64,128),n.noFill(),n.rect(1,1,t-2,o-2),n.rect(c+1,d+1,a-2,l-2),0===h){for(let e=1,t=c;e<i;e+=1)t+=p,n.line(t,d,t,u);for(let e=1,t=d;e<s;e+=1)t+=w,n.line(c,t,g,t)}else{for(let e=1,t=c;e<i;e+=1)t+=m,n.line(t,d,t,u),t+=h,n.line(t,d,t,u);for(let e=1,t=d;e<s;e+=1)t+=f,n.line(c,t,g,t),t+=h,n.line(c,t,g,t)}n.pop()},Y=[];let G,V,J,q=void 0,K=!1,Q=()=>{n.background(255),n.push(),n.stroke(224),n.noFill(),n.strokeWeight(1),n.rect(1,1,n.width-2,n.height-2),n.pop()};const U=()=>{K=!1,n.cursor(n.ARROW),V.style("cursor","pointer"),J.style("cursor","pointer")},Z=e=>t=>{if(t.length<=0)return;const o=((e,t)=>{const{width:o,height:r,rows:s,columns:h,outerMargin:a,innerMargin:l,backgroundColorCode:c}=t,d=e.length,{cellWidth:g,cellHeight:u}=$(t),p=n.createGraphics(o,r),w=n.color(c);n.alpha(w)>0&&p.background(w),p.push(),p.imageMode(n.CENTER),p.translate(a.left+g/2,a.top+u/2);let m=0;for(let t=0,n=0;t<s;t+=1,n+=u+l)for(let t=0,o=0;t<h&&!(m>=d);t+=1,o+=g+l){const t=e[m++],r=i(t,{width:g,height:u});p.image(t,o,n,r.width,r.height)}return p.pop(),p})(t,e),s=((e,t)=>{const n=r(e,t);return{width:e.width*n,height:e.height*n}})(o,n);Q=()=>{n.background(255),n.image(o,n.width/2,n.height/2,s.width,s.height)},Q(),q=o},_=()=>{if(K)return;const{parameters:e}=G,t=e.rows*e.columns;if(t<1)return;const o=n.shuffle(Y).slice(0,t);o.length<=0||(K=!0,n.cursor(n.WAIT),V.style("cursor","wait"),J.style("cursor","wait"),((e,t)=>{if(e.length<=0)return void(t.onEnd&&t.onEnd(e));const n=Object.assign(Object.create(u),t),{getAlt:o,hide:i,onLoadEach:r,onFailEach:s,warnOnFail:h,onSuccess:a,onEnd:l}=n;let c=n.onFailAny;const p=e.length,w=[];let m=0;for(let t=0;t<e.length;t+=1){const n=e[t];d({file:n,alt:o(n),hide:i,onLoad:(n,o)=>{r(n,o,t),w.push(n),w.length===p&&a(w),m+=1,m===p&&l(e)},onFail:n=>{s(n,t),c(e),c=g,m+=1,m===p&&l(e)},warnOnFail:h})}})(o,{hide:!0,warnOnFail:!0,onSuccess:Z(e),onEnd:U}))},ee=()=>{q&&n.save(q,G.parameters.fileName)},te=()=>{const e=(e=>{const{position:t,size:n,initialColumns:o}=e,i=n.width/o;return{position:t,size:n,columns:o,cellSize:{width:i,height:i},elements:[]}})({position:b,size:F,initialColumns:4}),t=(e,t)=>{e.style("pointer-events","none"),Y.push(t)};(e=>{const{position:t,size:o,onDrop:i}=e,r=n.createDiv("Drop image files here"),s=()=>{r.style("background-color","#FDFDFD"),r.style("cursor","auto")};a(r,t).size(o.width,o.height),r.addClass("drop-zone"),r.dragOver(()=>{r.style("background-color","#F0FAFF"),r.style("cursor","wait")}).dragLeave(s).drop(i,()=>{s(),r.elt.innerHTML=""}),s()})({position:y,size:v,onDrop:n=>((e,t,n)=>{"image"===t.type?d({file:t,alt:t.name,onLoad:(t,o)=>{B(e,t),n(t,o)}}).hide():console.warn("Dropped file that is not an image:",t)})(e,n,t)})},ne=()=>{switch((()=>{const e=window.navigator.userAgent.toLowerCase();return-1!==e.indexOf("msie")||-1!==e.indexOf("trident")?o.IE:-1!==e.indexOf("edge")?o.Edge:-1!==e.indexOf("chrome")?o.Chrome:-1!==e.indexOf("safari")?o.Safari:-1!==e.indexOf("firefox")?o.FireFox:-1!==e.indexOf("opera")?o.Opera:o.Other})()){case o.IE:return n.createP("Internet Explorer is not supported."),n.createP("Please use another browser."),!1;case o.Edge:return n.createP("Microsoft Edge is not supported."),n.createP("Please use another browser."),!1;default:return!0}},oe=()=>{if(!ne())return;const{width:e,height:t}=I,o=n.createCanvas(e,t);a(o,L),window.addEventListener("dragover",e=>{e.preventDefault()},!1),window.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation()},!1),n.imageMode(n.CENTER),te(),V=c({label:"generate",onClick:_,position:E,size:x,cursor:"pointer"}),J=c({label:"save",onClick:ee,position:M,size:C,cursor:"pointer"}),G=R({onMouseEnter:e=>{X(e.parameters)},onMouseLeave:()=>{Q()},onChange:e=>{Q(),X(e.parameters)}}),n.background(255),X(k)};new e(e=>{(e=>n=e)(e),n.setup=oe},document.getElementById("ImageGridResult")||document.body)}(p5,jsyaml);