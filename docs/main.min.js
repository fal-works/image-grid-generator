/**
 * Image Grid Generator.
 * @copyright FAL
 * @version 1.0.0
 */
!function(t){"use strict";let e;t=t&&t.hasOwnProperty("default")?t.default:t;const i=(t,e)=>{const{width:i,height:o}=t,n=Math.min(e.width/i,e.height/o);return{width:i*n,height:o*n}},o=t=>t.size(),n="absolute",r=(t,e,i=n)=>{const o=t.elt.style,{x:r,y:h}=e;return o.position=i,o.left=`${r}px`,o.top=`${h}px`,t},h=(t,e,n)=>{((t,e)=>{const n=i(o(t),e);t.size(n.width,n.height)})(t,n);const h=o(t);r(t,{x:e.x+(n.width-h.width)/2,y:e.y+(n.height-h.height)/2})},s=t=>{const{label:i,onClick:o,position:n,size:h,cursor:s}=t,l=e.createButton(i);return l.mouseClicked(o),r(l,n),l.size(h.width,h.height),s&&l.style("cursor",s),l},l=t=>{const{file:{data:i},alt:o,hide:n}=t,r=e.createImg(i,o,()=>{const{file:e,warnOnFail:i,onLoad:o,onFail:n}=t;if(!r)return i&&console.warn(`"Failed to load ${e.name}`),void(n&&n(e));o&&o(r,e)});return n&&r.hide(),r},a=()=>{},c=()=>void 0,d=1280,g=800,u=0,p={width:d-g,height:g},w={x:u,y:0},m={width:p.width-20,height:420},f={x:w.x+1,y:w.y+1},y={width:m.width-2,height:m.height-2},v={x:u,y:w.y+m.height+20},b={width:120,height:40},F={x:v.x+16+b.width,y:v.y},M={width:120,height:40},C={x:u,y:v.y+40+20},z={width:p.width-20,height:p.height-(m.height+20+40+20)},x={width:d-p.width,height:g},k={x:p.width,y:0},E={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",fileName:"image-grid.png"},L=(t=>JSON.stringify(t,void 0,2))(E),I=(t,e)=>""===t||isFinite(e)||"object"==typeof e&&!Array.isArray(e)||"string"==typeof e?e:void 0,O=(t,e,i=-1e4,o=1e4)=>{const n=parseInt(t);return Number.isFinite(n)&&n>=i&&n<=o?n:e},D=(t,e,i=100)=>{const o=t.toString();return"string"==typeof o&&o.length>0&&o.length<=i?o:e},N=t=>{return{width:O(t.width,E.width,1),height:O(t.height,E.height,1),columns:O(t.columns,E.columns,1),rows:O(t.rows,E.rows,1),outerMargin:(t=>{const e=E.outerMargin;if("number"==typeof t){const i=O(t,e.top);return{top:i,bottom:i,left:i,right:i}}return{top:O(t.top,e.top),bottom:O(t.bottom,e.bottom),left:O(t.left,e.left),right:O(t.right,e.right)}})(t.outerMargin),innerMargin:O(t.innerMargin,E.innerMargin),backgroundColorCode:D(t.backgroundColorCode,E.backgroundColorCode),fileName:D(t.fileName,E.fileName)}},W=t=>{const{width:e,height:i,columns:o,rows:n,outerMargin:r,innerMargin:h}=t,s=t.width-r.left-r.right,l=t.height-r.top-r.bottom;return{contentWidth:s,contentHeight:l,contentLeftX:r.left,contentTopY:r.top,contentRightX:e-r.right,contentBottomY:i-r.bottom,columnWidth:s/o,rowHeight:l/n,cellWidth:(s-(o-1)*h)/o,cellHeight:(l-(n-1)*h)/n}},T=()=>{},A={onChange:T,onMouseEnter:T,onMouseLeave:T},H=t=>{const{onChange:i,onMouseEnter:o,onMouseLeave:n}=Object.assign(Object.create(A),t),h=(t=>{const{position:i,size:o,initialValue:n}=t,h=e.createElement("textarea",n);return r(h,i).size(o.width,o.height),h})({position:C,size:z,initialValue:L}),s={element:h,contentText:L,parameters:E,monitorIntervalId:void 0},l=()=>{const t=h.value().toString();t!==s.contentText&&(s.contentText=t,s.parameters=(t=>{if("string"!=typeof t)return E;try{return N(JSON.parse(t,I))}catch(t){return E}})(t),i(s))};return h.elt.addEventListener("focus",()=>{s.monitorIntervalId=setInterval(l,100)}),h.elt.addEventListener("blur",()=>{const{monitorIntervalId:t}=s;t&&(clearInterval(t),s.monitorIntervalId=void 0)}),h.elt.addEventListener("mouseenter",o.bind(void 0,s)),h.elt.addEventListener("mouseleave",n.bind(void 0,s)),s},S=(t,e,i,o,n)=>{const r=Math.floor(e/o),s=e%o,l={x:i.x+n.width*s,y:i.y+n.height*r};h(t,l,n)},R=(t,e)=>{const{position:i,size:o,cellSize:n,columns:r,elements:h}=t;e.show(),S(e,h.length,i,r,n),t.elements.push(e),Math.ceil(h.length/r)*n.height>o.height&&((t,e)=>{const{position:i,size:o,elements:n}=t;t.columns=e;const r=o.width/e;t.cellSize={width:r,height:r};for(let o=0;o<n.length;o+=1)S(n[o],o,i,e,t.cellSize)})(t,r+1)},B=t=>{const{width:i,height:o,columns:n,rows:r,innerMargin:h}=t,{contentWidth:s,contentHeight:l,contentLeftX:a,contentTopY:c,contentRightX:d,contentBottomY:g,columnWidth:u,rowHeight:p,cellWidth:w,cellHeight:m}=W(t);if(e.push(),e.translate((e.width-i)/2,(e.height-o)/2),e.stroke(255,64,128),e.noFill(),e.rect(1,1,i-2,o-2),e.rect(a+1,c+1,s-2,l-2),0===h){for(let t=1,i=a;t<n;t+=1)i+=u,e.line(i,c,i,g);for(let t=1,i=c;t<r;t+=1)i+=p,e.line(a,i,d,i)}else{for(let t=1,i=a;t<n;t+=1)i+=w,e.line(i,c,i,g),i+=h,e.line(i,c,i,g);for(let t=1,i=c;t<r;t+=1)i+=m,e.line(a,i,d,i),i+=h,e.line(a,i,d,i)}e.pop()},X=[];let Y,j,$,G=void 0,J=!1,P=()=>{e.background(255),e.push(),e.stroke(224),e.noFill(),e.strokeWeight(1),e.rect(1,1,e.width-2,e.height-2),e.pop()};const V=()=>{J=!1,e.cursor(e.ARROW),j.style("cursor","pointer"),$.style("cursor","pointer")},q=t=>o=>{if(o.length<=0)return void V();const n=((t,o)=>{const{width:n,height:r,rows:h,columns:s,outerMargin:l,innerMargin:a,backgroundColorCode:c}=o,d=t.length,{cellWidth:g,cellHeight:u}=W(o),p=e.createGraphics(n,r),w=e.color(c);e.alpha(w)>0&&p.background(w),p.push(),p.imageMode(e.CENTER),p.translate(l.left+g/2,l.top+u/2);let m=0;for(let e=0,o=0;e<h;e+=1,o+=u+a)for(let e=0,n=0;e<s&&!(m>=d);e+=1,n+=g+a){const e=t[m++],r=i(e,{width:g,height:u});p.image(e,n,o,r.width,r.height)}return p.pop(),p})(o,t),r=((t,e)=>{const{width:i,height:o}=t,n=Math.min(1,Math.min(e.width/i,e.height/o));return{width:i*n,height:o*n}})(n,e);P=()=>{e.background(255),e.image(n,e.width/2,e.height/2,r.width,r.height)},P(),G=n,V()},K=()=>{if(J)return;const{parameters:t}=Y,i=t.rows*t.columns;if(i<1)return;const o=e.shuffle(X).slice(0,i);o.length<=0||(J=!0,e.cursor(e.WAIT),j.style("cursor","wait"),$.style("cursor","wait"),(t=>{const{files:e,hide:i,warnOnFail:o}=t;if(e.length<=0)return;const n=t.getAlt||c,r=t.onLoadEach||a,h=t.onFailEach||a,s=t.onComplete||a;let d=t.onFailAny||a;const g=e.length,u=[];for(let t=0;t<e.length;t+=1){const c=e[t];l({file:c,alt:n(c),hide:i,onLoad:(e,i)=>{r(e,i,t),u.push(e),u.length===g&&s(u)},onFail:i=>{h(i,t),d(e),d=a},warnOnFail:o})}})({files:o,hide:!0,warnOnFail:!0,onComplete:q(t),onFailAny:V}))},Q=()=>{G&&e.save(G,Y.parameters.fileName)},U=()=>{const t=(t=>{const{position:e,size:i,initialColumns:o}=t,n=i.width/o;return{position:e,size:i,columns:o,cellSize:{width:n,height:n},elements:[]}})({position:f,size:y,initialColumns:4}),i=(t,e)=>{t.style("pointer-events","none"),X.push(e)};(t=>{const{position:i,size:o,onDrop:n}=t,h=e.createDiv("Drop image files here"),s=()=>{h.style("background-color","#FDFDFD"),h.style("cursor","auto")};r(h,i).size(o.width,o.height),h.addClass("drop-zone"),h.dragOver(()=>{h.style("background-color","#F0FAFF"),h.style("cursor","wait")}).dragLeave(s).drop(n,()=>{s(),h.elt.innerHTML=""}),s()})({position:w,size:m,onDrop:e=>((t,e,i)=>{"image"===e.type?l({file:e,alt:e.name,onLoad:(e,o)=>{R(t,e),i(e,o)}}).hide():console.warn("Dropped file that is not an image:",e)})(t,e,i)})},Z=()=>{const{width:t,height:i}=x,o=e.createCanvas(t,i);r(o,k),window.addEventListener("dragover",t=>{t.preventDefault()},!1),window.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation()},!1),e.imageMode(e.CENTER),U(),j=s({label:"generate",onClick:K,position:v,size:b,cursor:"pointer"}),$=s({label:"save",onClick:Q,position:F,size:M,cursor:"pointer"}),Y=H({onMouseEnter:t=>{B(t.parameters)},onMouseLeave:()=>{P()},onChange:t=>{P(),B(t.parameters)}}),e.background(255),B(E)};new t(t=>{(t=>e=t)(t),e.setup=Z},document.getElementById("ImageGridResult")||document.body)}(p5);