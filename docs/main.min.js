/**
 * Image Grid Generator.
 * @copyright 2019 FAL
 * @version 1.0.2
 */
!function(e){"use strict";let t;e=e&&e.hasOwnProperty("default")?e.default:e;var n;!function(e){e[e.IE=0]="IE",e[e.Edge=1]="Edge",e[e.Chrome=2]="Chrome",e[e.Safari=3]="Safari",e[e.FireFox=4]="FireFox",e[e.Opera=5]="Opera",e[e.Other=6]="Other"}(n||(n={}));const o=(e,t)=>{const n=((e,t)=>{const{width:n,height:o}=e;return Math.min(t.width/n,t.height/o)})(e,t);return{width:e.width*n,height:e.height*n}},i=(e,t)=>{const{width:n,height:o}=e;return Math.min(1,Math.min(t.width/n,t.height/o))},r=e=>e.size(),h="absolute",s=(e,t,n=h)=>{const o=e.elt.style,{x:i,y:r}=t;return o.position=n,o.left=`${i}px`,o.top=`${r}px`,e},a=(e,t,n)=>{((e,t)=>{const n=o(r(e),t);e.size(n.width,n.height)})(e,n);const i=r(e);s(e,{x:t.x+(n.width-i.width)/2,y:t.y+(n.height-i.height)/2})},l=e=>{const{label:n,onClick:o,position:i,size:r,cursor:h}=e,a=t.createButton(n);return a.mouseClicked(o),s(a,i),a.size(r.width,r.height),h&&a.style("cursor",h),a},c=e=>{const{file:{data:n},alt:o,hide:i}=e,r=t.createImg(n,o,()=>{const{file:t,warnOnFail:n,onLoad:o,onFail:i}=e;if(!r)return n&&console.warn(`"Failed to load ${t.name}`),void(i&&i(t));o&&o(r,t)});return i&&r.hide(),r},d=()=>{},g={getAlt:()=>void 0,hide:!1,onLoadEach:d,onFailEach:d,warnOnFail:!0,onSuccess:d,onFailAny:d,onEnd:d},u=1035,p=640,w=0,m={width:u-p,height:p},f={x:w,y:0},y={width:m.width-20,height:280},v={x:f.x+2,y:f.y+2},b={width:y.width-4,height:y.height-4},F={x:w,y:f.y+y.height+15},E={width:120,height:40},x={x:F.x+16+E.width,y:F.y},M={width:120,height:40},C={x:w,y:F.y+40+15},O={width:m.width-20,height:m.height-(y.height+15+40+15)},z={width:u-m.width,height:p},I={x:m.width,y:0},k={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",fileName:"image-grid.png"},L=(e=>JSON.stringify(e,void 0,2))(k),S=(e,t)=>""===e||isFinite(t)||"object"==typeof t&&!Array.isArray(t)||"string"==typeof t?t:void 0,W=(e,t,n=-1e4,o=1e4)=>{const i=parseInt(e);return Number.isFinite(i)&&i>=n&&i<=o?i:t},A=(e,t,n=100)=>{const o=e.toString();return"string"==typeof o&&o.length>0&&o.length<=n?o:t},D=e=>{return{width:W(e.width,k.width,1),height:W(e.height,k.height,1),columns:W(e.columns,k.columns,1),rows:W(e.rows,k.rows,1),outerMargin:(e=>{const t=k.outerMargin;if("number"==typeof e){const n=W(e,t.top);return{top:n,bottom:n,left:n,right:n}}return{top:W(e.top,t.top),bottom:W(e.bottom,t.bottom),left:W(e.left,t.left),right:W(e.right,t.right)}})(e.outerMargin),innerMargin:W(e.innerMargin,k.innerMargin),backgroundColorCode:A(e.backgroundColorCode,k.backgroundColorCode),fileName:A(e.fileName,k.fileName)}},N=e=>{const{width:t,height:n,columns:o,rows:i,outerMargin:r,innerMargin:h}=e,s=e.width-r.left-r.right,a=e.height-r.top-r.bottom;return{contentWidth:s,contentHeight:a,contentLeftX:r.left,contentTopY:r.top,contentRightX:t-r.right,contentBottomY:n-r.bottom,columnWidth:s/o,rowHeight:a/i,cellWidth:(s-(o-1)*h)/o,cellHeight:(a-(i-1)*h)/i}},T=()=>{},H={onChange:T,onMouseEnter:T,onMouseLeave:T},P=e=>{const{onChange:n,onMouseEnter:o,onMouseLeave:i}=Object.assign(Object.create(H),e),r=(e=>{const{position:n,size:o,initialValue:i}=e,r=t.createElement("textarea",i);return s(r,n).size(o.width,o.height),r})({position:C,size:O,initialValue:L}),h={element:r,contentText:L,parameters:k,monitorIntervalId:void 0},a=()=>{const e=r.value().toString();e!==h.contentText&&(h.contentText=e,h.parameters=(e=>{if("string"!=typeof e)return k;try{return D(JSON.parse(e,S))}catch(e){return k}})(e),n(h))};return r.elt.addEventListener("focus",()=>{h.monitorIntervalId=setInterval(a,100)}),r.elt.addEventListener("blur",()=>{const{monitorIntervalId:e}=h;e&&(clearInterval(e),h.monitorIntervalId=void 0)}),r.elt.addEventListener("mouseenter",o.bind(void 0,h)),r.elt.addEventListener("mouseleave",i.bind(void 0,h)),h},R=(e,t,n,o,i)=>{const r=Math.floor(t/o),h=t%o,s={x:n.x+i.width*h,y:n.y+i.height*r};a(e,s,i)},j=(e,t)=>{const{position:n,size:o,cellSize:i,columns:r,elements:h}=e;t.show(),R(t,h.length,n,r,i),e.elements.push(t),Math.ceil(h.length/r)*i.height>o.height&&((e,t)=>{const{position:n,size:o,elements:i}=e;e.columns=t;const r=o.width/t;e.cellSize={width:r,height:r};for(let o=0;o<i.length;o+=1)R(i[o],o,n,t,e.cellSize)})(e,r+1)},B=e=>{const{width:n,height:o,columns:r,rows:h,innerMargin:s}=e,{contentWidth:a,contentHeight:l,contentLeftX:c,contentTopY:d,contentRightX:g,contentBottomY:u,columnWidth:p,rowHeight:w,cellWidth:m,cellHeight:f}=N(e);t.push(),t.translate(t.width/2,t.height/2);const y=i(e,t);if(t.scale(y),t.strokeWeight(1/y),t.translate(-n/2,-o/2),t.stroke(255,64,128),t.noFill(),t.rect(1,1,n-2,o-2),t.rect(c+1,d+1,a-2,l-2),0===s){for(let e=1,n=c;e<r;e+=1)n+=p,t.line(n,d,n,u);for(let e=1,n=d;e<h;e+=1)n+=w,t.line(c,n,g,n)}else{for(let e=1,n=c;e<r;e+=1)n+=m,t.line(n,d,n,u),n+=s,t.line(n,d,n,u);for(let e=1,n=d;e<h;e+=1)n+=f,t.line(c,n,g,n),n+=s,t.line(c,n,g,n)}t.pop()},X=[];let Y,$,G,J=void 0,V=!1,q=()=>{t.background(255),t.push(),t.stroke(224),t.noFill(),t.strokeWeight(1),t.rect(1,1,t.width-2,t.height-2),t.pop()};const K=()=>{V=!1,t.cursor(t.ARROW),$.style("cursor","pointer"),G.style("cursor","pointer")},Q=e=>n=>{if(n.length<=0)return;const r=((e,n)=>{const{width:i,height:r,rows:h,columns:s,outerMargin:a,innerMargin:l,backgroundColorCode:c}=n,d=e.length,{cellWidth:g,cellHeight:u}=N(n),p=t.createGraphics(i,r),w=t.color(c);t.alpha(w)>0&&p.background(w),p.push(),p.imageMode(t.CENTER),p.translate(a.left+g/2,a.top+u/2);let m=0;for(let t=0,n=0;t<h;t+=1,n+=u+l)for(let t=0,i=0;t<s&&!(m>=d);t+=1,i+=g+l){const t=e[m++],r=o(t,{width:g,height:u});p.image(t,i,n,r.width,r.height)}return p.pop(),p})(n,e),h=((e,t)=>{const n=i(e,t);return{width:e.width*n,height:e.height*n}})(r,t);q=()=>{t.background(255),t.image(r,t.width/2,t.height/2,h.width,h.height)},q(),J=r},U=()=>{if(V)return;const{parameters:e}=Y,n=e.rows*e.columns;if(n<1)return;const o=t.shuffle(X).slice(0,n);o.length<=0||(V=!0,t.cursor(t.WAIT),$.style("cursor","wait"),G.style("cursor","wait"),((e,t)=>{if(e.length<=0)return void(t.onEnd&&t.onEnd(e));const n=Object.assign(Object.create(g),t),{getAlt:o,hide:i,onLoadEach:r,onFailEach:h,warnOnFail:s,onSuccess:a,onEnd:l}=n;let u=n.onFailAny;const p=e.length,w=[];let m=0;for(let t=0;t<e.length;t+=1){const n=e[t];c({file:n,alt:o(n),hide:i,onLoad:(n,o)=>{r(n,o,t),w.push(n),w.length===p&&a(w),m+=1,m===p&&l(e)},onFail:n=>{h(n,t),u(e),u=d,m+=1,m===p&&l(e)},warnOnFail:s})}})(o,{hide:!0,warnOnFail:!0,onSuccess:Q(e),onEnd:K}))},Z=()=>{J&&t.save(J,Y.parameters.fileName)},_=()=>{const e=(e=>{const{position:t,size:n,initialColumns:o}=e,i=n.width/o;return{position:t,size:n,columns:o,cellSize:{width:i,height:i},elements:[]}})({position:v,size:b,initialColumns:4}),n=(e,t)=>{e.style("pointer-events","none"),X.push(t)};(e=>{const{position:n,size:o,onDrop:i}=e,r=t.createDiv("Drop image files here"),h=()=>{r.style("background-color","#FDFDFD"),r.style("cursor","auto")};s(r,n).size(o.width,o.height),r.addClass("drop-zone"),r.dragOver(()=>{r.style("background-color","#F0FAFF"),r.style("cursor","wait")}).dragLeave(h).drop(i,()=>{h(),r.elt.innerHTML=""}),h()})({position:f,size:y,onDrop:t=>((e,t,n)=>{"image"===t.type?c({file:t,alt:t.name,onLoad:(t,o)=>{j(e,t),n(t,o)}}).hide():console.warn("Dropped file that is not an image:",t)})(e,t,n)})},ee=()=>{switch((()=>{const e=window.navigator.userAgent.toLowerCase();return-1!==e.indexOf("msie")||-1!==e.indexOf("trident")?n.IE:-1!==e.indexOf("edge")?n.Edge:-1!==e.indexOf("chrome")?n.Chrome:-1!==e.indexOf("safari")?n.Safari:-1!==e.indexOf("firefox")?n.FireFox:-1!==e.indexOf("opera")?n.Opera:n.Other})()){case n.IE:return t.createP("Internet Explorer is not supported."),t.createP("Please use another browser."),!1;case n.Edge:return t.createP("Microsoft Edge is not supported."),t.createP("Please use another browser."),!1;default:return!0}},te=()=>{if(!ee())return;const{width:e,height:n}=z,o=t.createCanvas(e,n);s(o,I),window.addEventListener("dragover",e=>{e.preventDefault()},!1),window.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation()},!1),t.imageMode(t.CENTER),_(),$=l({label:"generate",onClick:U,position:F,size:E,cursor:"pointer"}),G=l({label:"save",onClick:Z,position:x,size:M,cursor:"pointer"}),Y=P({onMouseEnter:e=>{B(e.parameters)},onMouseLeave:()=>{q()},onChange:e=>{q(),B(e.parameters)}}),t.background(255),B(k)};new e(e=>{(e=>t=e)(e),t.setup=te},document.getElementById("ImageGridResult")||document.body)}(p5);