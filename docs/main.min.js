/**
 * Image Grid Generator.
 * @copyright 2019-2020 FAL
 * @version 1.1.1
 */
!function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}const i=n(e);let o;var r;!function(e){e[e.IE=0]="IE",e[e.Edge=1]="Edge",e[e.Chrome=2]="Chrome",e[e.Safari=3]="Safari",e[e.FireFox=4]="FireFox",e[e.Opera=5]="Opera",e[e.Other=6]="Other"}(r||(r={}));const s=(e,t)=>{const n=((e,t)=>{const{width:n,height:i}=e;return Math.min(t.width/n,t.height/i)})(e,t);return{width:e.width*n,height:e.height*n}},h=(e,t)=>{const{width:n,height:i}=e;return Math.min(1,Math.min(t.width/n,t.height/i))},a=e=>e.size(),l="absolute",c=(e,t,n=l)=>{const i=e.elt.style,{x:o,y:r}=t;return i.position=n,i.left=o+"px",i.top=r+"px",e},d=(e,t,n)=>{((e,t)=>{const n=s(a(e),t);e.size(n.width,n.height)})(e,n);const i=a(e);c(e,{x:t.x+(n.width-i.width)/2,y:t.y+(n.height-i.height)/2})},g=e=>{const{label:t,onClick:n,position:i,size:r,cursor:s}=e,h=o.createButton(t);return h.mouseClicked(n),c(h,i),h.size(r.width,r.height),s&&h.style("cursor",s),h},u=e=>{const{file:{data:t},alt:n,hide:i}=e,r=o.createImg(t,n,()=>{const{file:t,warnOnFail:n,onLoad:i,onFail:o}=e;if(!r)return n&&console.warn('"Failed to load '+t.name),void(o&&o(t));i&&i(r,t)});return i&&r.hide(),r},p=()=>{},w={getAlt:()=>{},hide:!1,onLoadEach:p,onFailEach:p,warnOnFail:!0,onSuccess:p,onFailAny:p,onEnd:p},m=1035,f=640,y=0,v={width:m-f,height:f},b={x:y,y:0},F={width:v.width-20,height:280},x={x:b.x+2,y:b.y+2},E={width:F.width-4,height:F.height-4},M={x:y,y:b.y+F.height+15},C={width:120,height:40},O={x:M.x+16+C.width,y:M.y},z={width:120,height:40},L={x:y,y:M.y+40+15},k={width:v.width-20,height:v.height-(F.height+15+40+15+5+30)},I={x:y,y:v.height-30},S=70,A=30,N={width:60,height:30},D={x:v.width-20-N.width,y:I.y},W={width:m-v.width,height:f},T={x:v.width,y:0},H={width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",fileName:"image-grid.png"},R=e=>t.safeDump(e),j=R(H),P=(e,t)=>""===e||isFinite(t)||"object"==typeof t&&!Array.isArray(t)||"string"==typeof t?t:void 0,Y=(e,t,n=-1e4,i=1e4)=>{const o=parseInt(e);return Number.isFinite(o)&&o>=n&&o<=i?o:t},$="[\\da-fA-F]",B=new RegExp(`^(${$}{3}|${$}{4}|${$}{6}|${$}{8})$`),J=e=>({width:Y(e.width,H.width,1),height:Y(e.height,H.height,1),columns:Y(e.columns,H.columns,1),rows:Y(e.rows,H.rows,1),outerMargin:(e=>{const t=H.outerMargin;if("number"==typeof e){const n=Y(e,t.top);return{top:n,bottom:n,left:n,right:n}}return{top:Y(e.top,t.top),bottom:Y(e.bottom,t.bottom),left:Y(e.left,t.left),right:Y(e.right,t.right)}})(e.outerMargin),innerMargin:Y(e.innerMargin,H.innerMargin),backgroundColorCode:((e,t)=>{const n=e.toString();return"string"==typeof n?n.match(B)?"#"+n:n:t})(e.backgroundColorCode,H.backgroundColorCode),fileName:((e,t,n=100)=>{const i=e.toString();return"string"==typeof i&&i.length>0&&i.length<=n?i:t})(e.fileName,H.fileName,255)}),X=e=>{const{width:t,height:n,columns:i,rows:o,outerMargin:r,innerMargin:s}=e,h=e.width-r.left-r.right,a=e.height-r.top-r.bottom;return{contentWidth:h,contentHeight:a,contentLeftX:r.left,contentTopY:r.top,contentRightX:t-r.right,contentBottomY:n-r.bottom,columnWidth:h/i,rowHeight:a/o,cellWidth:(h-(i-1)*s)/i,cellHeight:(a-(o-1)*s)/o}},G=()=>{},V={onChange:G,onMouseEnter:G,onMouseLeave:G},q=e=>{const{onChange:n,onMouseEnter:i,onMouseLeave:r}=Object.assign(Object.create(V),e),s=(e=>{const{position:t,size:n,initialValue:i}=e,r=o.createElement("textarea",i);return c(r,t).size(n.width,n.height),r})({position:L,size:k,initialValue:j}),h={element:s,contentText:j,parameters:H,monitorIntervalId:void 0},a=()=>{const e=s.value().toString();e!==h.contentText&&(h.contentText=e,h.parameters=(e=>{if("string"!=typeof e)return H;const n=e.trim();try{return"{"===n.substr(0,1)?J(JSON.parse(n,P)):J(t.safeLoad(n))}catch(e){return H}})(e),n(h))},l=e=>{h.element.value(e),a()},d=e=>l((e=>JSON.stringify(e,void 0,2))(e)),u=s.elt;u.addEventListener("focus",()=>{h.monitorIntervalId=setInterval(a,100)}),u.addEventListener("blur",()=>{const{monitorIntervalId:e}=h;e&&(clearInterval(e),h.monitorIntervalId=void 0)}),u.addEventListener("mouseenter",i.bind(void 0,h)),u.addEventListener("mouseleave",r.bind(void 0,h));const p=o.createSelect();p.position(I.x,I.y),p.size(S,A),p.option("YAML"),p.option("JSON"),p.changed(()=>{switch(p.value().toString()){case"YAML":e=h.parameters,l(R(e));break;case"JSON":d(h.parameters)}var e});return g({label:"reset",onClick:()=>{l(j),p.value("YAML")},position:D,size:N,cursor:"pointer"}).style("font-size","medium"),h},K=(e,t,n,i,o)=>{const r=Math.floor(t/i),s=t%i,h={x:n.x+o.width*s,y:n.y+o.height*r};d(e,h,o)},Q=(e,t)=>{const{position:n,size:i,cellSize:o,columns:r,elements:s}=e;t.show(),K(t,s.length,n,r,o),e.elements.push(t);Math.ceil(s.length/r)*o.height>i.height&&((e,t)=>{const{position:n,size:i,elements:o}=e;e.columns=t;const r=i.width/t;e.cellSize={width:r,height:r};for(let i=0;i<o.length;i+=1)K(o[i],i,n,t,e.cellSize)})(e,r+1)},U=e=>{const{width:t,height:n,columns:i,rows:r,innerMargin:s}=e,{contentWidth:a,contentHeight:l,contentLeftX:c,contentTopY:d,contentRightX:g,contentBottomY:u,columnWidth:p,rowHeight:w,cellWidth:m,cellHeight:f}=X(e);o.push(),o.translate(o.width/2,o.height/2);const y=h(e,o);if(o.scale(y),o.strokeWeight(1/y),o.translate(-t/2,-n/2),o.stroke(255,64,128),o.noFill(),o.rect(1,1,t-2,n-2),o.rect(c+1,d+1,a-2,l-2),0===s){for(let e=1,t=c;e<i;e+=1)t+=p,o.line(t,d,t,u);for(let e=1,t=d;e<r;e+=1)t+=w,o.line(c,t,g,t)}else{for(let e=1,t=c;e<i;e+=1)t+=m,o.line(t,d,t,u),t+=s,o.line(t,d,t,u);for(let e=1,t=d;e<r;e+=1)t+=f,o.line(c,t,g,t),t+=s,o.line(c,t,g,t)}o.pop()},Z=[];let _,ee,te,ne=void 0,ie=!1,oe=()=>{o.background(255),o.push(),o.stroke(224),o.noFill(),o.strokeWeight(1),o.rect(1,1,o.width-2,o.height-2),o.pop()};const re=()=>{ie=!1,o.cursor(o.ARROW),ee.style("cursor","pointer"),te.style("cursor","pointer")},se=e=>t=>{if(t.length<=0)return;const n=((e,t)=>{const{width:n,height:i,rows:r,columns:h,outerMargin:a,innerMargin:l,backgroundColorCode:c}=t,d=e.length,{cellWidth:g,cellHeight:u}=X(t),p=o.createGraphics(n,i),w=o.color(c);o.alpha(w)>0&&p.background(w),p.push(),p.imageMode(o.CENTER),p.translate(a.left+g/2,a.top+u/2);let m=0;for(let t=0,n=0;t<r;t+=1,n+=u+l)for(let t=0,i=0;t<h&&!(m>=d);t+=1,i+=g+l){const t=e[m++],o=s(t,{width:g,height:u});p.image(t,i,n,o.width,o.height)}return p.pop(),p})(t,e),i=((e,t)=>{const n=h(e,t);return{width:e.width*n,height:e.height*n}})(n,o);oe=()=>{o.background(255),o.image(n,o.width/2,o.height/2,i.width,i.height)},oe(),ne=n},he=()=>{if(ie)return;const{parameters:e}=_,t=e.rows*e.columns;if(t<1)return;const n=o.shuffle(Z).slice(0,t);n.length<=0||(ie=!0,o.cursor(o.WAIT),ee.style("cursor","wait"),te.style("cursor","wait"),((e,t)=>{if(e.length<=0)return void(t.onEnd&&t.onEnd(e));const n=Object.assign(Object.create(w),t),{getAlt:i,hide:o,onLoadEach:r,onFailEach:s,warnOnFail:h,onSuccess:a,onEnd:l}=n;let c=n.onFailAny;const d=e.length,g=[];let m=0;for(let t=0;t<e.length;t+=1){const n=e[t];u({file:n,alt:i(n),hide:o,onLoad:(n,i)=>{r(n,i,t),g.push(n),g.length===d&&a(g),m+=1,m===d&&l(e)},onFail:n=>{s(n,t),c(e),c=p,m+=1,m===d&&l(e)},warnOnFail:h})}})(n,{hide:!0,warnOnFail:!0,onSuccess:se(e),onEnd:re}))},ae=()=>{ne&&o.save(ne,_.parameters.fileName)},le=()=>{const e=(e=>{const{position:t,size:n,initialColumns:i}=e,o=n.width/i;return{position:t,size:n,columns:i,cellSize:{width:o,height:o},elements:[]}})({position:x,size:E,initialColumns:4}),t=(e,t)=>{e.style("pointer-events","none"),Z.push(t)};(e=>{const{position:t,size:n,onDrop:i}=e,r=o.createDiv("Drop image files here"),s=()=>{r.style("background-color","#FDFDFD"),r.style("cursor","auto")};c(r,t).size(n.width,n.height),r.addClass("drop-zone");const h=r.elt;r.dragOver(()=>{r.style("background-color","#F0FAFF"),r.style("cursor","wait")}).dragLeave(s).drop(i,()=>{s(),h.innerHTML=""}),s()})({position:b,size:F,onDrop:n=>((e,t,n)=>{"image"===t.type?u({file:t,alt:t.name,onLoad:(t,i)=>{Q(e,t),n(t,i)}}).hide():console.warn("Dropped file that is not an image:",t)})(e,n,t)})},ce=()=>{switch((()=>{const e=window.navigator.userAgent.toLowerCase();return-1!==e.indexOf("msie")||-1!==e.indexOf("trident")?r.IE:-1!==e.indexOf("edge")?r.Edge:-1!==e.indexOf("chrome")?r.Chrome:-1!==e.indexOf("safari")?r.Safari:-1!==e.indexOf("firefox")?r.FireFox:-1!==e.indexOf("opera")?r.Opera:r.Other})()){case r.IE:return o.createP("Internet Explorer is not supported."),o.createP("Please use another browser."),!1;case r.Edge:return o.createP("Microsoft Edge is not supported."),o.createP("Please use another browser."),!1;default:return!0}},de=()=>{if(!ce())return;const{width:e,height:t}=W,n=o.createCanvas(e,t);c(n,T),window.addEventListener("dragover",e=>{e.preventDefault()},!1),window.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation()},!1),o.imageMode(o.CENTER),le(),ee=g({label:"generate",onClick:he,position:M,size:C,cursor:"pointer"}),te=g({label:"save",onClick:ae,position:O,size:z,cursor:"pointer"}),_=q({onMouseEnter:e=>{U(e.parameters)},onMouseLeave:()=>{oe()},onChange:e=>{oe(),U(e.parameters)}}),o.background(255),U(H)};new i.default(e=>{(e=>{o=e})(e),o.setup=de},document.getElementById("ImageGridResult")||document.body)}(p5,jsyaml);