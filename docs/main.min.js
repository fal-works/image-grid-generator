/**
 * Image Grid Generator.
 * @copyright 2019-2020 FAL
 * @version 1.2.0
 */
!function(e,t){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}const n=o(e);let i;var r;!function(e){e[e.IE=0]="IE",e[e.Edge=1]="Edge",e[e.Chrome=2]="Chrome",e[e.Safari=3]="Safari",e[e.FireFox=4]="FireFox",e[e.Opera=5]="Opera",e[e.Other=6]="Other"}(r||(r={}));const s=(e,t)=>{const o=((e,t)=>{const{width:o,height:n}=e;return Math.min(t.width/o,t.height/n)})(e,t);return{width:e.width*o,height:e.height*o}},h=(e,t)=>{const{width:o,height:n}=e;return Math.min(1,Math.min(t.width/o,t.height/n))},a=e=>e.size(),l="absolute",c=(e,t,o=l)=>{const n=e.elt.style,{x:i,y:r}=t;return n.position=o,n.left=i+"px",n.top=r+"px",e},d=(e,t,o)=>{((e,t)=>{const o=s(a(e),t);e.size(o.width,o.height)})(e,o);const n=a(e);c(e,{x:t.x+(o.width-n.width)/2,y:t.y+(o.height-n.height)/2})},g=e=>{const{label:t,onClick:o,position:n,size:r,cursor:s}=e,h=i.createButton(t);return h.mouseClicked(o),c(h,n),h.size(r.width,r.height),s&&h.style("cursor",s),h},u=e=>{const{file:{data:t},alt:o,hide:n}=e,r=i.createImg(t,o,()=>{const{file:t,warnOnFail:o,onLoad:n,onFail:i}=e;if(!r)return o&&console.warn('"Failed to load '+t.name),void(i&&i(t));n&&n(r,t)});return n&&r.hide(),r},f=()=>{},p={getAlt:()=>{},hide:!1,onLoadEach:f,onFailEach:f,warnOnFail:!0,onSuccess:f,onFailAny:f,onEnd:f},w=1035,m=640,y=0,b={width:w-m,height:m},v={x:y,y:0},x={width:b.width-20,height:280},F={x:v.x+2,y:v.y+2},E={width:x.width-4,height:x.height-4},M={x:y,y:v.y+x.height+15},C={width:120,height:40},O={x:M.x+16+C.width,y:M.y},z={width:120,height:40},L={x:y,y:M.y+40+15},k={width:b.width-20,height:b.height-(x.height+15+40+15+5+30)},I={x:y,y:b.height-30},S=70,A=30,Y={width:60,height:30},N={x:b.width-20-Y.width,y:I.y},D={width:w-b.width,height:m},W={x:b.width,y:0},X={fileName:"image-grid.png",width:800,height:800,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",shadow:{color:"rgba(0, 0, 0, 0)",blur:0,offsetX:0,offsetY:0}},T=e=>t.safeDump(e),H=T(X),R=(e,t)=>""===e||isFinite(t)||"object"==typeof t&&!Array.isArray(t)||"string"==typeof t?t:void 0,j=(e,t,o=-1e4,n=1e4)=>{const i=parseInt(e);return Number.isFinite(i)&&i>=o&&i<=n?i:t},P=(e,t,o=100)=>{const n=e.toString();return"string"==typeof n&&n.length>0&&n.length<=o?n:t},B="[\\da-fA-F]",$=new RegExp(`^(${B}{3}|${B}{4}|${B}{6}|${B}{8})$`),J=e=>({fileName:P(e.fileName,X.fileName,255),width:j(e.width,X.width,1),height:j(e.height,X.height,1),columns:j(e.columns,X.columns,1),rows:j(e.rows,X.rows,1),outerMargin:(e=>{const t=X.outerMargin;if("number"==typeof e){const o=j(e,t.top);return{top:o,bottom:o,left:o,right:o}}return{top:j(e.top,t.top),bottom:j(e.bottom,t.bottom),left:j(e.left,t.left),right:j(e.right,t.right)}})(e.outerMargin),innerMargin:j(e.innerMargin,X.innerMargin),backgroundColorCode:((e,t)=>{const o=e.toString();return"string"==typeof o?o.match($)?"#"+o:o:t})(e.backgroundColorCode,X.backgroundColorCode),shadow:(e=>{const t=X.shadow;return{color:P(e.color,t.color),blur:j(e.blur,t.blur),offsetX:j(e.offsetX,t.offsetX),offsetY:j(e.offsetY,t.offsetY)}})(e.shadow)}),G=e=>{const{width:t,height:o,columns:n,rows:i,outerMargin:r,innerMargin:s}=e,h=e.width-r.left-r.right,a=e.height-r.top-r.bottom;return{contentWidth:h,contentHeight:a,contentLeftX:r.left,contentTopY:r.top,contentRightX:t-r.right,contentBottomY:o-r.bottom,columnWidth:h/n,rowHeight:a/i,cellWidth:(h-(n-1)*s)/n,cellHeight:(a-(i-1)*s)/i}},V=()=>{},q={onChange:V,onMouseEnter:V,onMouseLeave:V},K=e=>{const{onChange:o,onMouseEnter:n,onMouseLeave:r}=Object.assign(Object.create(q),e),s=(e=>{const{position:t,size:o,initialValue:n}=e,r=i.createElement("textarea",n);return c(r,t).size(o.width,o.height),r})({position:L,size:k,initialValue:H}),h={element:s,contentText:H,parameters:X,monitorIntervalId:void 0},a=()=>{const e=s.value().toString();e!==h.contentText&&(h.contentText=e,h.parameters=(e=>{if("string"!=typeof e)return X;const o=e.trim();try{return"{"===o.substr(0,1)?J(JSON.parse(o,R)):J(t.safeLoad(o))}catch(e){return X}})(e),o(h))},l=e=>{h.element.value(e),a()},d=e=>l((e=>JSON.stringify(e,void 0,2))(e)),u=s.elt;u.addEventListener("focus",()=>{h.monitorIntervalId=setInterval(a,100)}),u.addEventListener("blur",()=>{const{monitorIntervalId:e}=h;e&&(clearInterval(e),h.monitorIntervalId=void 0)}),u.addEventListener("mouseenter",n.bind(void 0,h)),u.addEventListener("mouseleave",r.bind(void 0,h));const f=i.createSelect();f.position(I.x,I.y),f.size(S,A),f.option("YAML"),f.option("JSON"),f.changed(()=>{switch(f.value().toString()){case"YAML":e=h.parameters,l(T(e));break;case"JSON":d(h.parameters)}var e});return g({label:"reset",onClick:()=>{l(H),f.value("YAML")},position:N,size:Y,cursor:"pointer"}).style("font-size","medium"),h},Q=(e,t,o,n,i)=>{const r=Math.floor(t/n),s=t%n,h={x:o.x+i.width*s,y:o.y+i.height*r};d(e,h,i)},U=(e,t)=>{const{position:o,size:n,cellSize:i,columns:r,elements:s}=e;t.show(),Q(t,s.length,o,r,i),e.elements.push(t);Math.ceil(s.length/r)*i.height>n.height&&((e,t)=>{const{position:o,size:n,elements:i}=e;e.columns=t;const r=n.width/t;e.cellSize={width:r,height:r};for(let n=0;n<i.length;n+=1)Q(i[n],n,o,t,e.cellSize)})(e,r+1)},Z=e=>{const{width:t,height:o,columns:n,rows:r,innerMargin:s}=e,{contentWidth:a,contentHeight:l,contentLeftX:c,contentTopY:d,contentRightX:g,contentBottomY:u,columnWidth:f,rowHeight:p,cellWidth:w,cellHeight:m}=G(e);i.push(),i.translate(i.width/2,i.height/2);const y=h(e,i);if(i.scale(y),i.strokeWeight(1/y),i.translate(-t/2,-o/2),i.stroke(255,64,128),i.noFill(),i.rect(1,1,t-2,o-2),i.rect(c+1,d+1,a-2,l-2),0===s){for(let e=1,t=c;e<n;e+=1)t+=f,i.line(t,d,t,u);for(let e=1,t=d;e<r;e+=1)t+=p,i.line(c,t,g,t)}else{for(let e=1,t=c;e<n;e+=1)t+=w,i.line(t,d,t,u),t+=s,i.line(t,d,t,u);for(let e=1,t=d;e<r;e+=1)t+=m,i.line(c,t,g,t),t+=s,i.line(c,t,g,t)}i.pop()},_=[];let ee,te,oe,ne=void 0,ie=!1,re=()=>{i.background(255),i.push(),i.stroke(224),i.noFill(),i.strokeWeight(1),i.rect(1,1,i.width-2,i.height-2),i.pop()};const se=()=>{ie=!1,i.cursor(i.ARROW),te.style("cursor","pointer"),oe.style("cursor","pointer")},he=e=>t=>{if(t.length<=0)return;const o=((e,t)=>{const{width:o,height:n,rows:r,columns:h,outerMargin:a,innerMargin:l,backgroundColorCode:c,shadow:d}=t,g=e.length,{cellWidth:u,cellHeight:f}=G(t),p=i.createGraphics(o,n),w=i.color(c);i.alpha(w)>0&&p.background(w),p.push(),p.imageMode(i.CENTER),p.translate(a.left+u/2,a.top+f/2);let m=0;for(let t=0,o=0;t<r;t+=1,o+=f+l)for(let t=0,n=0;t<h&&!(m>=g);t+=1,n+=u+l){const t=e[m++],i=s(t,{width:u,height:f});p.push();const r=p.drawingContext;r.shadowColor=d.color,r.shadowBlur=d.blur,r.shadowOffsetX=d.offsetX,r.shadowOffsetY=d.offsetY,p.image(t,n,o,i.width,i.height),p.pop()}return p.pop(),p})(t,e),n=((e,t)=>{const o=h(e,t);return{width:e.width*o,height:e.height*o}})(o,i);re=()=>{i.background(255),i.image(o,i.width/2,i.height/2,n.width,n.height)},re(),ne=o},ae=()=>{if(ie)return;const{parameters:e}=ee,t=e.rows*e.columns;if(t<1)return;const o=i.shuffle(_).slice(0,t);o.length<=0||(ie=!0,i.cursor(i.WAIT),te.style("cursor","wait"),oe.style("cursor","wait"),((e,t)=>{if(e.length<=0)return void(t.onEnd&&t.onEnd(e));const o=Object.assign(Object.create(p),t),{getAlt:n,hide:i,onLoadEach:r,onFailEach:s,warnOnFail:h,onSuccess:a,onEnd:l}=o;let c=o.onFailAny;const d=e.length,g=[];let w=0;for(let t=0;t<e.length;t+=1){const o=e[t];u({file:o,alt:n(o),hide:i,onLoad:(o,n)=>{r(o,n,t),g.push(o),g.length===d&&a(g),w+=1,w===d&&l(e)},onFail:o=>{s(o,t),c(e),c=f,w+=1,w===d&&l(e)},warnOnFail:h})}})(o,{hide:!0,warnOnFail:!0,onSuccess:he(e),onEnd:se}))},le=()=>{ne&&i.save(ne,ee.parameters.fileName)},ce=()=>{const e=(e=>{const{position:t,size:o,initialColumns:n}=e,i=o.width/n;return{position:t,size:o,columns:n,cellSize:{width:i,height:i},elements:[]}})({position:F,size:E,initialColumns:4}),t=(e,t)=>{e.style("pointer-events","none"),_.push(t)};(e=>{const{position:t,size:o,onDrop:n}=e,r=i.createDiv("Drop image files here"),s=()=>{r.style("background-color","#FDFDFD"),r.style("cursor","auto")};c(r,t).size(o.width,o.height),r.addClass("drop-zone");const h=r.elt;r.dragOver(()=>{r.style("background-color","#F0FAFF"),r.style("cursor","wait")}).dragLeave(s).drop(n,()=>{s(),h.innerHTML=""}),s()})({position:v,size:x,onDrop:o=>((e,t,o)=>{"image"===t.type?u({file:t,alt:t.name,onLoad:(t,n)=>{U(e,t),o(t,n)}}).hide():console.warn("Dropped file that is not an image:",t)})(e,o,t)})},de=()=>{switch((()=>{const e=window.navigator.userAgent.toLowerCase();return-1!==e.indexOf("msie")||-1!==e.indexOf("trident")?r.IE:-1!==e.indexOf("edge")?r.Edge:-1!==e.indexOf("chrome")?r.Chrome:-1!==e.indexOf("safari")?r.Safari:-1!==e.indexOf("firefox")?r.FireFox:-1!==e.indexOf("opera")?r.Opera:r.Other})()){case r.IE:return i.createP("Internet Explorer is not supported."),i.createP("Please use another browser."),!1;case r.Edge:return i.createP("Microsoft Edge is not supported."),i.createP("Please use another browser."),!1;default:return!0}},ge=()=>{if(!de())return;const{width:e,height:t}=D,o=i.createCanvas(e,t);c(o,W),window.addEventListener("dragover",e=>{e.preventDefault()},!1),window.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation()},!1),i.imageMode(i.CENTER),ce(),te=g({label:"generate",onClick:ae,position:M,size:C,cursor:"pointer"}),oe=g({label:"save",onClick:le,position:O,size:z,cursor:"pointer"}),ee=K({onMouseEnter:e=>{Z(e.parameters)},onMouseLeave:()=>{re()},onChange:e=>{re(),Z(e.parameters)}}),i.background(255),Z(X)};new n.default(e=>{(e=>{i=e})(e),i.setup=ge},document.getElementById("ImageGridResult")||document.body)}(p5,jsyaml);